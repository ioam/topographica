
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>topo.command.pylabplot &mdash; The Topographica Neural Map Simulator</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/topo.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.98',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/topo.js"></script>
    <link rel="top" title="The Topographica Neural Map Simulator" href="../../../index.html" />
    <link rel="up" title="topo.command" href="../command.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
<li><a href="../../../index.html">Home</a></li>
<li><a href="../../../Downloads/index.html">Downloads</a></li>
<li><a href="../../../Tutorials/index.html">Tutorials</a></li>
<li><a href="../../../User_Manual/index.html">User Manual</a></li>


<li><ul class="parents">



          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../command.html" accesskey="U">topo.command</a> &raquo;</li>

</ul></li>


      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for topo.command.pylabplot</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Line-based and matrix-based plotting commands using MatPlotLib.</span>

<span class="sd">Before importing this file, you will probably want to do something</span>
<span class="sd">like:</span>

<span class="sd">  from matplotlib import rcParams</span>
<span class="sd">  rcParams[&#39;backend&#39;]=&#39;TkAgg&#39;</span>

<span class="sd">to select a backend, or else select an appropriate one in your</span>
<span class="sd">matplotlib.rc file (if any).  There are many backends available for</span>
<span class="sd">different GUI or non-GUI uses.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">param</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">matplotlib.ticker</span>
    <span class="kn">import</span> <span class="nn">pylab</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">param</span><span class="o">.</span><span class="n">Parameterized</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Could not import matplotlib; module will not be useable.&quot;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">topo.command</span> <span class="kn">import</span> <span class="n">ImportErrorRaisingFakeModule</span>
    <span class="n">pylab</span> <span class="o">=</span> <span class="n">ImportErrorRaisingFakeModule</span><span class="p">(</span><span class="s">&quot;matplotlib&quot;</span><span class="p">)</span>  <span class="c"># pyflakes:ignore (try/except import)</span>


<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span>
<span class="c"># JABALERT: Import all of these from numpy instead?</span>
<span class="kn">from</span> <span class="nn">numpy.oldnumeric</span> <span class="kn">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">argmin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">log10</span><span class="p">,</span> <span class="n">Float</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">outer</span><span class="p">,</span><span class="n">arange</span><span class="p">,</span><span class="n">ones</span><span class="p">,</span><span class="n">zeros</span>

<span class="kn">from</span> <span class="nn">numpy.fft.fftpack</span> <span class="kn">import</span> <span class="n">fft2</span>
<span class="kn">from</span> <span class="nn">numpy.fft.helper</span> <span class="kn">import</span> <span class="n">fftshift</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="nb">abs</span>

<span class="kn">import</span> <span class="nn">topo</span>
<span class="kn">from</span> <span class="nn">topo.base.sheetview</span> <span class="kn">import</span> <span class="n">SheetView</span>
<span class="kn">from</span> <span class="nn">topo.base.arrayutil</span> <span class="kn">import</span> <span class="n">centroid</span><span class="p">,</span> <span class="n">wrap</span>
<span class="kn">from</span> <span class="nn">topo.base.sheet</span> <span class="kn">import</span> <span class="n">Sheet</span>
<span class="kn">from</span> <span class="nn">topo.misc.util</span> <span class="kn">import</span> <span class="n">frange</span>
<span class="kn">import</span> <span class="nn">topo.analysis.vision</span>
<span class="kn">from</span> <span class="nn">topo.plotting.plot</span> <span class="kn">import</span> <span class="n">make_template_plot</span>
<span class="kn">import</span> <span class="nn">param</span>
<span class="kn">from</span> <span class="nn">param</span> <span class="kn">import</span> <span class="n">ParameterizedFunction</span><span class="p">,</span><span class="n">normalize_path</span>
<span class="kn">from</span> <span class="nn">param.parameterized</span> <span class="kn">import</span> <span class="n">ParamOverrides</span>
<span class="kn">from</span> <span class="nn">topo.pattern</span> <span class="kn">import</span> <span class="n">SineGrating</span><span class="p">,</span> <span class="n">OrientationContrast</span>
<span class="kn">from</span> <span class="nn">topo.plotting.plotgroup</span> <span class="kn">import</span> <span class="n">create_plotgroup</span>
<span class="kn">from</span> <span class="nn">topo.base.cf</span> <span class="kn">import</span> <span class="n">CFSheet</span>

<span class="kn">from</span> <span class="nn">topo.analysis.featureresponses</span> <span class="kn">import</span> <span class="n">Feature</span><span class="p">,</span> <span class="n">PatternPresenter</span>
<span class="kn">from</span> <span class="nn">topo.analysis.featureresponses</span> <span class="kn">import</span> <span class="n">PositionMeasurementCommand</span><span class="p">,</span> <span class="n">FeatureCurveCommand</span><span class="p">,</span> <span class="n">UnitCurveCommand</span>


<span class="kn">from</span> <span class="nn">topo.command</span> <span class="kn">import</span> <span class="n">Command</span>





<div class="viewcode-block" id="PylabPlotCommand"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.PylabPlotCommand">[docs]</a><span class="k">class</span> <span class="nc">PylabPlotCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parameterized command for plotting using Matplotlib/Pylab.&quot;&quot;&quot;</span>

    <span class="n">file_dpi</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Default DPI when rendering to a bitmap.</span>
<span class="s">        The nominal size * the dpi gives the final image size in pixels.</span>
<span class="s">        E.g.: 4&quot;x4&quot; image * 80 dpi ==&gt; 320x320 pixel image.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">file_format</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&quot;png&quot;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Which image format to use when saving images.</span>
<span class="s">        The output can be png, ps, pdf, svg, or any other format</span>
<span class="s">        supported by Matplotlib.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c"># JABALERT: Should replace this with a filename_format and</span>
    <span class="c"># associated parameters, as in PlotGroupSaver.</span>
    <span class="c"># Also should probably allow interactive display to be controlled</span>
    <span class="c"># separately from the filename, to make things work more similarly</span>
    <span class="c"># with and without a GUI.</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Optional base of the filename to use when saving images;</span>
<span class="s">        if None the plot will be displayed interactively.</span>

<span class="s">        The actual name is constructed from the filename base plus the</span>
<span class="s">        suffix plus the current simulator time plus the file_format.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">filename_suffix</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Optional suffix to be used for disambiguation of the filename.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Optional title to be used when displaying the plot interactively.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">__abstract</span> <span class="o">=</span> <span class="bp">True</span>


    <span class="k">def</span> <span class="nf">_set_windowtitle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function to set the title (if not None) of this PyLab plot window.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># At the moment, PyLab does not offer a window-manager-independent</span>
        <span class="c"># means for controlling the window title, so what we do is to try</span>
        <span class="c"># what should work with Tkinter, and then suppress all errors.  That</span>
        <span class="c"># way we should be ok when rendering to a file-based backend, but</span>
        <span class="c"># will get nice titles in Tk windows.  If other toolkits are in use,</span>
        <span class="c"># the title can be set here using a similar try/except mechanism, or</span>
        <span class="c"># else there can be a switch based on the backend type.</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">manager</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">get_current_fig_manager</span><span class="p">()</span>
                <span class="n">manager</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>


    <span class="k">def</span> <span class="nf">_generate_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function to display a figure on screen or save to a file.</span>

<span class="sd">        p should be a ParamOverrides instance containing the current</span>
<span class="sd">        set of parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="o">.</span><span class="n">_needmain</span><span class="o">=</span><span class="bp">False</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># JABALERT: need to reformat this as for other plots</span>
            <span class="n">fullname</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">filename_suffix</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="o">+</span><span class="s">&quot;.&quot;</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">file_format</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">fullname</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">file_dpi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_windowtitle</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


</div>
<div class="viewcode-block" id="vectorplot"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.vectorplot">[docs]</a><span class="k">class</span> <span class="nc">vectorplot</span><span class="p">(</span><span class="n">PylabPlotCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple line plotting for any vector or list of numbers.</span>

<span class="sd">    Intended for interactive debugging or analyzing from the command</span>
<span class="sd">    prompt.  See MatPlotLib&#39;s pylab functions to create more elaborate</span>
<span class="sd">    or customized plots; this is just a simple example.</span>

<span class="sd">    An optional string can be supplied as a title for the figure, if</span>
<span class="sd">    desired.  At present, this is only used for the window, not the</span>
<span class="sd">    actual body of the figure (and will thus not appear when the</span>
<span class="sd">    figure is saved).</span>

<span class="sd">    The style argument allows different line/linespoints style for</span>
<span class="sd">    the plot: &#39;r-&#39; for red solid line, &#39;bx&#39; for blue x-marks, etc.</span>
<span class="sd">    See http://matplotlib.sourceforge.net/matplotlib.pylab.html#-plot</span>
<span class="sd">    for more possibilities.</span>

<span class="sd">    The label argument can be used to identify the line in a figure legend.</span>

<span class="sd">    Ordinarily, the x value for each point on the line is the index of</span>
<span class="sd">    that point in the vec array, but a explicit list of xvalues can be</span>
<span class="sd">    supplied; it should be the same length as vec.</span>

<span class="sd">    Execution of multiple vectorplot() commands with different styles</span>
<span class="sd">    will result in all those styles overlaid on a single plot window.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># JABALERT: All but the first two arguments should probably be Parameters</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vec</span><span class="p">,</span><span class="n">xvalues</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xvalues</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xvalues</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

        <span class="n">pylab</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_figure</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="matrixplot"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.matrixplot">[docs]</a><span class="k">class</span> <span class="nc">matrixplot</span><span class="p">(</span><span class="n">PylabPlotCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple plotting for any matrix as a bitmap with axes.</span>

<span class="sd">    Like MatLab&#39;s imagesc, scales the values to fit in the range 0 to 1.0.</span>
<span class="sd">    Intended for interactive debugging or analyzing from the command</span>
<span class="sd">    prompt.  See MatPlotLib&#39;s pylab functions to create more elaborate</span>
<span class="sd">    or customized plots; this is just a simple example.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">plot_type</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Callable</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Matplotlib command to generate the plot, e.g. pylab.gray or pylab.hsv.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">extent</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Subregion of the matrix to plot, as a tuple (l,b,r,t).&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c"># JABALERT: All but the first two should probably be Parameters</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mat</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">colorbar</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>

        <span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">plot_type</span><span class="p">()</span>

        <span class="c"># Swap lbrt to lrbt to match pylab</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">extent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">extent</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">extent</span>
            <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>

        <span class="n">pylab</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colorbar</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">!=</span> <span class="n">mat</span><span class="o">.</span><span class="n">max</span><span class="p">()):</span> <span class="n">pylab</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_figure</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="matrixplot3d"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.matrixplot3d">[docs]</a><span class="k">class</span> <span class="nc">matrixplot3d</span><span class="p">(</span><span class="n">PylabPlotCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple plotting for any matrix as a 3D wireframe with axes.</span>

<span class="sd">    Uses Matplotlib&#39;s beta-quality features for 3D plotting.  These</span>
<span class="sd">    usually work fine for wireframe plots, although they don&#39;t always</span>
<span class="sd">    format the axis labels properly, and do not support removal of</span>
<span class="sd">    hidden lines.  Note that often the plot can be rotated within the</span>
<span class="sd">    window to make such problems go away, and then the best result can</span>
<span class="sd">    be saved if needed.</span>

<span class="sd">    Other than the default &quot;wireframe&quot;, the type can be &quot;contour&quot; to</span>
<span class="sd">    get a contour plot, or &quot;surface&quot; to get a solid surface plot, but</span>
<span class="sd">    surface plots currently fail in many cases, e.g. for small</span>
<span class="sd">    matrices.</span>

<span class="sd">    If you have trouble, you can try matrixplot3d_gnuplot instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mat</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;wireframe&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">axes3d</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="c"># Construct matrices for r and c values</span>
        <span class="n">rn</span><span class="p">,</span><span class="n">cn</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">outer</span><span class="p">(</span><span class="n">ones</span><span class="p">(</span><span class="n">rn</span><span class="p">),</span><span class="n">arange</span><span class="p">(</span><span class="n">cn</span><span class="o">*</span><span class="mf">1.0</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">outer</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="n">rn</span><span class="o">*</span><span class="mf">1.0</span><span class="p">),</span><span class="n">ones</span><span class="p">(</span><span class="n">cn</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">type</span><span class="o">==</span><span class="s">&quot;wireframe&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">mat</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="o">==</span><span class="s">&quot;surface&quot;</span><span class="p">:</span>
            <span class="c"># Sometimes fails for no obvious reason</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">mat</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="o">==</span><span class="s">&quot;contour&quot;</span><span class="p">:</span>
            <span class="c"># Works but not usually very useful</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">contour3D</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">mat</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Unknown plot type &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;R&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;C&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Value&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_figure</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="matrixplot3dx3"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.matrixplot3dx3">[docs]</a><span class="k">class</span> <span class="nc">matrixplot3dx3</span><span class="p">(</span><span class="n">PylabPlotCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot three matching matrices x,y,z as a 3D wireframe with axes.</span>
<span class="sd">    See matrixplot3d for caveats and description; this plot is the</span>
<span class="sd">    same but instead of using implicit r,c values of the matrix, allows</span>
<span class="sd">    them to be specified directly, thus plotting a series of 3D points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;X&quot;</span><span class="p">,</span><span class="s">&quot;Y&quot;</span><span class="p">,</span><span class="s">&quot;Z&quot;</span><span class="p">],</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;wireframe&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
    
        <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">axes3d</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="nb">type</span><span class="o">==</span><span class="s">&quot;wireframe&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="o">==</span><span class="s">&quot;surface&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="o">==</span><span class="s">&quot;contour&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">contour3D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Unknown plot type &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">))</span>
            
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_figure</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="matrixplot3d_gnuplot"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.matrixplot3d_gnuplot">[docs]</a><span class="k">def</span> <span class="nf">matrixplot3d_gnuplot</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">outputfilename</span><span class="o">=</span><span class="s">&quot;tmp.ps&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple plotting for any matrix as a 3D surface with axes.</span>

<span class="sd">    Currently requires the gnuplot-py package to be installed, plus</span>
<span class="sd">    the external gnuplot program; likely to be removed once Matplotlib</span>
<span class="sd">    supports 3D plots better.</span>

<span class="sd">    Unlikely to work on non-UNIX systems.</span>

<span class="sd">    Should return when it completes, but for some reason the Topographica</span>
<span class="sd">    prompt is not available until this command finishes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">Gnuplot</span>
    <span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">system</span>

    <span class="n">psviewer</span><span class="o">=</span><span class="s">&quot;gv&quot;</span> <span class="c"># Should be a parameter, or handled better somehow</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">Gnuplot</span><span class="o">.</span><span class="n">Gnuplot</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c">#debug=1: output commands to stderr</span>
    <span class="n">r</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="c"># The .tolist() command is necessary to avoid bug in gnuplot-py,</span>
    <span class="c"># which will otherwise convert a 2D float array into integers (!)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float32&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="c">#g(&quot;set parametric&quot;)</span>
    <span class="n">g</span><span class="p">(</span><span class="s">&quot;set data style lines&quot;</span><span class="p">)</span>
    <span class="n">g</span><span class="p">(</span><span class="s">&quot;set hidden3d&quot;</span><span class="p">)</span>
    <span class="n">g</span><span class="p">(</span><span class="s">&quot;set xlabel &#39;R&#39;&quot;</span><span class="p">)</span>
    <span class="n">g</span><span class="p">(</span><span class="s">&quot;set ylabel &#39;C&#39;&quot;</span><span class="p">)</span>
    <span class="n">g</span><span class="p">(</span><span class="s">&quot;set zlabel &#39;Value&#39;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">outputfilename</span><span class="p">:</span>
        <span class="n">g</span><span class="p">(</span><span class="s">&quot;set terminal postscript eps color solid &#39;Times-Roman&#39; 14&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="p">(</span><span class="s">&quot;set output &#39;&quot;</span><span class="o">+</span><span class="n">outputfilename</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">splot</span><span class="p">(</span><span class="n">Gnuplot</span><span class="o">.</span><span class="n">GridData</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="c">#g.hardcopy(outputfilename, enhanced=1, color=1)</span>
        <span class="n">system</span><span class="p">(</span><span class="n">psviewer</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">outputfilename</span><span class="o">+</span><span class="s">&quot; &amp;&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">splot</span><span class="p">(</span><span class="n">Gnuplot</span><span class="o">.</span><span class="n">GridData</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;Please press return to continue...</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="histogramplot"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.histogramplot">[docs]</a><span class="k">class</span> <span class="nc">histogramplot</span><span class="p">(</span><span class="n">PylabPlotCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute and plot the histogram of the supplied data.</span>

<span class="sd">    See help(pylab.hist) for help on the histogram function itself.</span>

<span class="sd">    If given, colors is an iterable collection of matplotlib.colors</span>
<span class="sd">    (see help (matplotlib.colors) ) specifying the bar colors.</span>

<span class="sd">    Example use:</span>
<span class="sd">        histogramplot([1,1,1,2,2,3,4,5],title=&#39;hist&#39;,colors=&#39;rgb&#39;,bins=3,normed=1)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># JABALERT: All but the first two arguments should probably be Parameters</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">allow_extra_keywords</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">n</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">bars</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="o">**</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">extra_keywords</span><span class="p">()))</span>

        <span class="c"># if len(bars)!=len(colors), any extra bars won&#39;t have their</span>
        <span class="c"># colors changed, or any extra colors will be ignored.</span>
        <span class="k">if</span> <span class="n">colors</span><span class="p">:</span> <span class="p">[</span><span class="n">bar</span><span class="o">.</span><span class="n">set_fc</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="k">for</span> <span class="n">bar</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bars</span><span class="p">,</span><span class="n">colors</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_figure</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="gradientplot"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.gradientplot">[docs]</a><span class="k">class</span> <span class="nc">gradientplot</span><span class="p">(</span><span class="n">matrixplot</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute and show the gradient plot of the supplied data.</span>
<span class="sd">    Translated from Octave code originally written by Yoonsuck Choe.</span>

<span class="sd">    If the data is specified to be cyclic, negative differences will</span>
<span class="sd">    be wrapped into the range specified (1.0 by default).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># JABALERT: All but the first two arguments should probably be Parameters</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">cyclic_range</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>

        <span class="n">r</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">cyclic</span><span class="p">:</span> <span class="c"># Wrap into the specified range</span>
            <span class="c"># Convert negative differences to an equivalent positive value</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">cyclic_range</span><span class="p">,</span><span class="n">dx</span><span class="p">)</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">cyclic_range</span><span class="p">,</span><span class="n">dy</span><span class="p">)</span>
            <span class="c">#</span>
            <span class="c"># Make it increase as gradient reaches the halfway point,</span>
            <span class="c"># and decrease from there</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">cyclic_range</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">dx</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">cyclic_range</span><span class="p">)</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">cyclic_range</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">dy</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">cyclic_range</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">gradientplot</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__call__</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">),</span><span class="o">**</span><span class="n">p</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="fftplot"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.fftplot">[docs]</a><span class="k">class</span> <span class="nc">fftplot</span><span class="p">(</span><span class="n">matrixplot</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute and show the 2D Fast Fourier Transform (FFT) of the supplied data.</span>

<span class="sd">    Example:: fftplot(topo.sim[&quot;V1&quot;].sheet_views[&quot;OrientationPreference&quot;].view()[0],filename=&quot;out&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
        <span class="n">fft_plot</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">fftshift</span><span class="p">(</span><span class="n">fft2</span><span class="p">(</span><span class="n">data</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">fftplot</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__call__</span><span class="p">(</span><span class="n">fft_plot</span><span class="p">,</span><span class="o">**</span><span class="n">p</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="autocorrelationplot"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.autocorrelationplot">[docs]</a><span class="k">class</span> <span class="nc">autocorrelationplot</span><span class="p">(</span><span class="n">matrixplot</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute and show the 2D autocorrelation of the supplied data.</span>
<span class="sd">    Requires the external SciPy package.</span>

<span class="sd">    Example:: autocorrelationplot(topo.sim[&quot;V1&quot;].sheet_views[&quot;OrientationPreference&quot;].view()[0],filename=&quot;out&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">plot_type</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Callable</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">autumn</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">scipy.signal</span>
        <span class="n">mat</span><span class="o">=</span><span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">correlate2d</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">autocorrelationplot</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__call__</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="o">**</span><span class="n">p</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="activityplot"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.activityplot">[docs]</a><span class="k">class</span> <span class="nc">activityplot</span><span class="p">(</span><span class="n">matrixplot</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the activity in a sheet with axis labels in Sheet (not matrix) coordinates.</span>

<span class="sd">    Same as matrixplot, but only for matrices associated with a Sheet.</span>
<span class="sd">    By default plots the Sheet&#39;s activity, but any other matrix of the</span>
<span class="sd">    same size may be supplied for plotting in these coordinates instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sheet</span><span class="p">,</span><span class="n">mat</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">extent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">extent</span><span class="o">=</span><span class="n">sheet</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">aarect</span><span class="p">()</span><span class="o">.</span><span class="n">lbrt</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mat</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">mat</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">activity</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">activityplot</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__call__</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="o">**</span><span class="n">p</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="topographic_grid"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.topographic_grid">[docs]</a><span class="k">class</span> <span class="nc">topographic_grid</span><span class="p">(</span><span class="n">PylabPlotCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    By default, plot the XPreference and YPreference preferences for all</span>
<span class="sd">    Sheets for which they are defined, using MatPlotLib.</span>

<span class="sd">    If sheet_views other than XPreference and YPreference are desired,</span>
<span class="sd">    the names of these can be passed in as arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">xsheet_view_name</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;XPreference&#39;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Name of the SheetView holding the X position locations.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">ysheet_view_name</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;YPreference&#39;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Name of the SheetView holding the Y position locations.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">axis</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Four-element list of the plot bounds, i.e. [xmin, xmax, ymin, ymax].&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">skip</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="bp">None</span><span class="p">],</span><span class="n">softbounds</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Plot every skipth line in each direction.</span>
<span class="s">        E.g. skip=4 means to keep only every fourth horizontal line</span>
<span class="s">        and every fourth vertical line, except that the first and last</span>
<span class="s">        are always included. The default is to include all data points.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">Sheet</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">xsheet_view_name</span> <span class="ow">in</span> <span class="n">sheet</span><span class="o">.</span><span class="n">sheet_views</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">ysheet_view_name</span> <span class="ow">in</span> <span class="n">sheet</span><span class="o">.</span><span class="n">sheet_views</span><span class="p">)):</span>

                <span class="n">x</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">sheet_views</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">xsheet_view_name</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">sheet_views</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">ysheet_view_name</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

                <span class="c"># This one-liner works in Octave, but in matplotlib it</span>
                <span class="c"># results in lines that are all connected across rows and columns,</span>
                <span class="c"># so here we plot each line separately:</span>
                <span class="c">#   pylab.plot(x,y,&quot;k-&quot;,transpose(x),transpose(y),&quot;k-&quot;)</span>
                <span class="c"># Here, the &quot;k-&quot; means plot in black using solid lines;</span>
                <span class="c"># see matplotlib for more info.</span>
                <span class="n">isint</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">()</span> <span class="c"># Temporarily make non-interactive for plotting</span>
                <span class="n">pylab</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y</span><span class="p">[::</span><span class="n">p</span><span class="o">.</span><span class="n">skip</span><span class="p">],</span><span class="n">x</span><span class="p">[::</span><span class="n">p</span><span class="o">.</span><span class="n">skip</span><span class="p">]):</span>
                    <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="s">&quot;k-&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">transpose</span><span class="p">(</span><span class="n">y</span><span class="p">)[::</span><span class="n">p</span><span class="o">.</span><span class="n">skip</span><span class="p">],</span><span class="n">transpose</span><span class="p">(</span><span class="n">x</span><span class="p">)[::</span><span class="n">p</span><span class="o">.</span><span class="n">skip</span><span class="p">]):</span>
                    <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="s">&quot;k-&quot;</span><span class="p">)</span>

                <span class="c"># Force last line avoid leaving cells open</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">skip</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s">&quot;k-&quot;</span><span class="p">)</span>
                    <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">transpose</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">transpose</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s">&quot;k-&quot;</span><span class="p">)</span>

                <span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
                <span class="n">pylab</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
                <span class="c"># Currently sets the input range arbitrarily; should presumably figure out</span>
                <span class="c"># what the actual possible range is for this simulation (which would presumably</span>
                <span class="c"># be the maximum size of any GeneratorSheet?).</span>
                <span class="n">pylab</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">axis</span><span class="p">)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Topographic mapping to &#39;</span><span class="o">+</span><span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s">&#39; at time &#39;</span><span class="o">+</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">timestr</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">isint</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
                <span class="n">p</span><span class="o">.</span><span class="n">filename_suffix</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="o">+</span><span class="n">sheet</span><span class="o">.</span><span class="n">name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_generate_figure</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="overlaid_plots"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.overlaid_plots">[docs]</a><span class="k">class</span> <span class="nc">overlaid_plots</span><span class="p">(</span><span class="n">PylabPlotCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use matplotlib to make a plot combining a bitmap and line-based overlays.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">plot_template</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[{</span><span class="s">&#39;Hue&#39;</span><span class="p">:</span><span class="s">&#39;OrientationPreference&#39;</span><span class="p">}],</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Template for the underlying bitmap plot.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">overlay</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;contours&#39;</span><span class="p">,</span><span class="s">&#39;OcularPreference&#39;</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="s">&#39;black&#39;</span><span class="p">),</span>
                                <span class="p">(</span><span class="s">&#39;arrows&#39;</span><span class="p">,</span><span class="s">&#39;DirectionPreference&#39;</span><span class="p">,</span><span class="s">&#39;DirectionSelectivity&#39;</span><span class="p">,</span><span class="s">&#39;white&#39;</span><span class="p">)],</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        List of overlaid plots, where each list item may be a 4-tuple</span>
<span class="s">        specifying either a contour line or a field of arrows::</span>

<span class="s">          (&#39;contours&#39;,map-name,contour-value,line-color)</span>

<span class="s">          (&#39;arrows&#39;,arrow-location-map-name,arrow-size-map-name,arrow-color)</span>

<span class="s">        Any number or combination of contours and arrows may be supplied.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">normalize</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;Individually&#39;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Type of normalization, if any, to use. Options include &#39;None&#39;,</span>
<span class="s">        &#39;Individually&#39;, and &#39;AllTogether&#39;. See</span>
<span class="s">        topo.plotting.plotgroup.TemplatePlotGroup.normalize for more</span>
<span class="s">        details.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">plot_template</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">Sheet</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">name</span><span class="o">=</span><span class="n">template</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">plot</span><span class="o">=</span><span class="n">make_template_plot</span><span class="p">(</span><span class="n">template</span><span class="p">,</span><span class="n">sheet</span><span class="o">.</span><span class="n">sheet_views</span><span class="p">,</span><span class="n">sheet</span><span class="o">.</span><span class="n">xdensity</span><span class="p">,</span><span class="n">sheet</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">normalize</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">template</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                    <span class="n">bitmap</span><span class="o">=</span><span class="n">plot</span><span class="o">.</span><span class="n">bitmap</span>
                    <span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
                    <span class="n">isint</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">()</span> <span class="c"># Temporarily make non-interactive for plotting</span>
                    <span class="n">pylab</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>                                         <span class="c"># Turn interactive mode off</span>

                    <span class="n">pylab</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">bitmap</span><span class="o">.</span><span class="n">image</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>
                    <span class="n">pylab</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

                    <span class="k">for</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">pref</span><span class="p">,</span><span class="n">sel</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">overlay</span><span class="p">:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">sheet_views</span><span class="p">[</span><span class="n">pref</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="o">==</span><span class="s">&#39;contours&#39;</span><span class="p">):</span>
                            <span class="n">pylab</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">v</span><span class="p">,[</span><span class="n">sel</span><span class="p">,</span><span class="n">sel</span><span class="p">],</span><span class="n">colors</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="o">==</span><span class="s">&#39;arrows&#39;</span><span class="p">):</span>
                            <span class="n">s</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">sheet_views</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">scale</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">pylab</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">))))</span>
                            <span class="n">X</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span><span class="p">)])</span>
                            <span class="n">v_sc</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span><span class="p">))</span>
                            <span class="n">s_sc</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">X</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">X</span><span class="p">:</span>
                                    <span class="n">v_sc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="n">scale</span><span class="o">*</span><span class="n">i</span><span class="p">][</span><span class="n">scale</span><span class="o">*</span><span class="n">j</span><span class="p">]</span>
                                    <span class="n">s_sc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">scale</span><span class="o">*</span><span class="n">i</span><span class="p">][</span><span class="n">scale</span><span class="o">*</span><span class="n">j</span><span class="p">]</span>
                            <span class="n">pylab</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">scale</span><span class="o">*</span><span class="n">X</span><span class="p">,</span><span class="n">scale</span><span class="o">*</span><span class="n">X</span><span class="p">,</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">v_sc</span><span class="p">)</span><span class="o">*</span><span class="n">s_sc</span><span class="p">,</span><span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">v_sc</span><span class="p">)</span><span class="o">*</span><span class="n">s_sc</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">minshaft</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                    <span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> overlaid with </span><span class="si">%s</span><span class="s"> at time </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">plot</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">pref</span><span class="p">,</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">timestr</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">isint</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">filename_suffix</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="o">+</span><span class="n">sheet</span><span class="o">.</span><span class="n">name</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_generate_figure</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="tuning_curve"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.tuning_curve">[docs]</a><span class="k">class</span> <span class="nc">tuning_curve</span><span class="p">(</span><span class="n">PylabPlotCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a tuning curve for a feature, such as orientation, contrast, or size.</span>

<span class="sd">    The curve datapoints are collected from the curve_dict for</span>
<span class="sd">    the units at the specified coordinates in the specified sheet</span>
<span class="sd">    (where the units and sheet may be set by a GUI, using</span>
<span class="sd">    topo.analysis.featureresponses.UnitCurveCommand.sheet and</span>
<span class="sd">    topo.analysis.featureresponses.UnitCurveCommand.coords,</span>
<span class="sd">    or by hand).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">coords</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)],</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        List of coordinates of units to measure.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">sheet</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ObjectSelector</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Name of the sheet to use in measurements.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">x_axis</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Feature to plot on the x axis of the tuning curve&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c"># Can we list some alternatives here, if there are any</span>
    <span class="c"># useful ones?</span>
    <span class="n">plot_type</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Callable</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Matplotlib command to generate the plot.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">unit</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        String to use in labels to specify the units in which curves are plotted.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">legend</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Whether or not to include a legend in the plot.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">__abstract</span> <span class="o">=</span> <span class="bp">True</span>


    <span class="k">def</span> <span class="nf">_format_x_tick_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%3.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">_rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="c"># n=hop interval</span>
        <span class="k">return</span> <span class="n">seq</span><span class="p">[</span><span class="n">n</span><span class="p">:]</span> <span class="o">+</span> <span class="n">seq</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_curve_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i_value</span><span class="p">,</span> <span class="n">j_value</span><span class="p">,</span> <span class="n">curve</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the x, y, and x ticks values for the specified curve from the curve_dict&quot;&quot;&quot;</span>
        <span class="n">x_values</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">y_values</span><span class="o">=</span><span class="p">[</span><span class="n">curve</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="n">i_value</span><span class="p">,</span><span class="n">j_value</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">x_values</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">x_values</span><span class="p">,</span><span class="n">y_values</span><span class="p">,</span><span class="n">x_values</span>

    <span class="k">def</span> <span class="nf">_reduce_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ticks</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="n">y</span><span class="o">=</span>  <span class="p">[];</span>
        <span class="n">num_ticks</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ticks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">num_ticks</span><span class="p">):</span>
            <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="n">num_ticks</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
            <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="n">num_ticks</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="n">num_ticks</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">3.14</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
        <span class="n">sheet</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">sheet</span>
        <span class="k">for</span> <span class="n">coordinate</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
            <span class="n">i_value</span><span class="p">,</span><span class="n">j_value</span><span class="o">=</span><span class="n">sheet</span><span class="o">.</span><span class="n">sheet2matrixidx</span><span class="p">(</span><span class="n">coordinate</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">coordinate</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
            <span class="n">isint</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">()</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>

            <span class="n">pylab</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Response&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s">&#39;large&#39;</span><span class="p">)</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">x_axis</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span><span class="n">p</span><span class="o">.</span><span class="n">unit</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="s">&#39;large&#39;</span><span class="p">)</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Sheet </span><span class="si">%s</span><span class="s">, coordinate(x,y)=(</span><span class="si">%0.3f</span><span class="s">,</span><span class="si">%0.3f</span><span class="s">) at time </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">coordinate</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">coordinate</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">timestr</span><span class="p">()))</span>
            <span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s"> Tuning Curve&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">x_axis</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">first_curve</span><span class="o">=</span><span class="bp">True</span>
            <span class="k">for</span> <span class="n">curve_label</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">curve_dict</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">x_axis</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">x_values</span><span class="p">,</span><span class="n">y_values</span><span class="p">,</span><span class="n">ticks</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_curve_values</span><span class="p">(</span><span class="n">i_value</span><span class="p">,</span><span class="n">j_value</span><span class="p">,</span><span class="n">sheet</span><span class="o">.</span><span class="n">curve_dict</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">x_axis</span><span class="p">][</span><span class="n">curve_label</span><span class="p">])</span>

                <span class="n">x_tick_values</span><span class="p">,</span><span class="n">ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_ticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_x_tick_label</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">]</span>
                <span class="n">pylab</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">x_tick_values</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s">&#39;large&#39;</span><span class="p">)</span>
                <span class="n">pylab</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="s">&#39;large&#39;</span><span class="p">)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">plot_type</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">curve_label</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">first_curve</span><span class="o">=</span><span class="bp">False</span>

            <span class="k">if</span> <span class="n">isint</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generate_figure</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="cyclic_tuning_curve"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.cyclic_tuning_curve">[docs]</a><span class="k">class</span> <span class="nc">cyclic_tuning_curve</span><span class="p">(</span><span class="n">tuning_curve</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Same as tuning_curve, but rotates the curve so that minimum y</span>
<span class="sd">    values are at the minimum x value to make the plots easier to</span>
<span class="sd">    interpret.  Such rotation is valid only for periodic quantities</span>
<span class="sd">    like orientation or direction, and only if the correct period</span>
<span class="sd">    is set.</span>

<span class="sd">    At present, the y_values and labels are rotated by an amount</span>
<span class="sd">    determined by the minmum y_value for the first curve plotted</span>
<span class="sd">    (usually the lowest contrast curve).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cyclic_range</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">pi</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Range of the cyclic quantity (e.g. pi for the orientation of</span>
<span class="s">        a symmetric stimulus, or 2*pi for motion direction or the</span>
<span class="s">        orientation of a non-symmetric stimulus).&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">unit</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&quot;degrees&quot;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        String to use in labels to specify the units in which curves are plotted.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="c"># This implementation should work for quantities periodic with</span>
    <span class="c"># some multiple of pi that we want to express in degrees, but it</span>
    <span class="c"># will need to be reimplemented in a subclass to work with other</span>
    <span class="c"># cyclic quantities.</span>
    <span class="k">def</span> <span class="nf">_format_x_tick_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">180</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">pi</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">_curve_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i_value</span><span class="p">,</span> <span class="n">j_value</span><span class="p">,</span> <span class="n">curve</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the x, y, and x ticks values for the specified curve from the curve_dict.</span>

<span class="sd">        With the current implementation, there may be cases (i.e.,</span>
<span class="sd">        when the lowest contrast curve gives a lot of zero y_values)</span>
<span class="sd">        in which the maximum is not in the center.  This may</span>
<span class="sd">        eventually be changed so that the preferred orientation is in</span>
<span class="sd">        the center.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_curve</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">x_values</span><span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">y_values</span><span class="o">=</span><span class="p">[</span><span class="n">curve</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="n">i_value</span><span class="p">,</span><span class="n">j_value</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">x_values</span><span class="p">]</span>

            <span class="n">min_arg</span><span class="o">=</span><span class="n">argmin</span><span class="p">(</span><span class="n">y_values</span><span class="p">)</span>
            <span class="n">x_min</span><span class="o">=</span><span class="n">x_values</span><span class="p">[</span><span class="n">min_arg</span><span class="p">]</span>
            <span class="n">y_min</span><span class="o">=</span><span class="n">y_values</span><span class="p">[</span><span class="n">min_arg</span><span class="p">]</span>
            <span class="n">y_values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_rotate</span><span class="p">(</span><span class="n">y_values</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">min_arg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ticks</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_rotate</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">min_arg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ticks</span><span class="o">+=</span><span class="p">[</span><span class="n">x_min</span><span class="p">]</span>
            <span class="n">x_max</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">cyclic_range</span>
            <span class="n">x_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_max</span><span class="p">)</span>
            <span class="n">y_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_min</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">x_values</span><span class="o">=</span><span class="n">x_values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_values</span><span class="o">=</span><span class="p">[</span><span class="n">curve</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="n">i_value</span><span class="p">,</span><span class="n">j_value</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_values</span><span class="p">,</span><span class="n">y_values</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks</span>


</div>
<div class="viewcode-block" id="plot_cfproj_mapping"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.plot_cfproj_mapping">[docs]</a><span class="k">def</span> <span class="nf">plot_cfproj_mapping</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span><span class="n">proj</span><span class="o">=</span><span class="s">&#39;Afferent&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s">&#39;b-&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a CF sheet receiving a CFProjection, plot</span>
<span class="sd">    the mapping of the dests CF centers on the src sheet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">topo</span> <span class="kn">import</span> <span class="n">sim</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="n">sim</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span>
    <span class="n">plot_coord_mapping</span><span class="p">(</span><span class="n">dest</span><span class="o">.</span><span class="n">projections</span><span class="p">()[</span><span class="n">proj</span><span class="p">]</span><span class="o">.</span><span class="n">coord_mapper</span><span class="p">,</span>
                       <span class="n">dest</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>


<span class="c"># JABALERT: not sure whether this is currently used</span></div>
<div class="viewcode-block" id="plot_coord_mapping"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.plot_coord_mapping">[docs]</a><span class="k">def</span> <span class="nf">plot_coord_mapping</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span><span class="n">sheet</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s">&#39;b-&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a coordinate mapping for a sheet.</span>

<span class="sd">    Given a CoordinateMapperFn (as for a CFProjection) and a sheet</span>
<span class="sd">    of the projection, plot a grid showing where the sheet&#39;s units</span>
<span class="sd">    are mapped.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="n">plot</span><span class="p">,</span><span class="n">hold</span><span class="p">,</span><span class="n">ishold</span>

    <span class="n">xs</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">sheet_rows</span><span class="p">()</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">sheet_cols</span><span class="p">()</span>

    <span class="n">hold_on</span> <span class="o">=</span> <span class="n">ishold</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">hold_on</span><span class="p">:</span>
        <span class="n">plot</span><span class="p">()</span>
    <span class="n">hold</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ys</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapper</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>
        <span class="n">plot</span><span class="p">([</span><span class="n">u</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">],</span>
             <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">],</span>
             <span class="n">style</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapper</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ys</span><span class="p">]</span>
        <span class="n">plot</span><span class="p">([</span><span class="n">u</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">],</span>
             <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">],</span>
             <span class="n">style</span><span class="p">)</span>

    <span class="n">hold</span><span class="p">(</span><span class="n">hold_on</span><span class="p">)</span>


<span class="c"># JABALERT: Untested as of Mon Nov 10 12:59:54 GMT 2008</span></div>
<div class="viewcode-block" id="plot_tracked_attributes"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.plot_tracked_attributes">[docs]</a><span class="k">class</span> <span class="nc">plot_tracked_attributes</span><span class="p">(</span><span class="n">PylabPlotCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots parameter values associated with an AttributeTrackingTF.</span>
<span class="sd">    Example call:</span>
<span class="sd">    VT=AttributeTrackingTF(function=HE, debug_params=[&#39;a&#39;, &#39;b&#39;,], units=[(0,0),(1,1)], step=1)</span>
<span class="sd">    plot_tracked_attributes(VT,0,10000,attrib_names=[&#39;a&#39;],units=[(0,0)], filename=&#39;V1&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># JABALERT: These parameters need to be documented.</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">attrib_names</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[])</span>

    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>

    <span class="c"># Should be renamed to coords to match other commands</span>
    <span class="n">units</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[])</span>

    <span class="n">ybounds</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">))</span>


    <span class="c"># JABALERT: All but the first two arguments should probably be Parameters</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">output_fn</span><span class="p">,</span><span class="n">init_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">final_time</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">final_time</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">final_time</span><span class="o">=</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">attrib_names</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">attrib_names</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="n">output_fn</span><span class="o">.</span><span class="n">attrib_names</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
            <span class="n">isint</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">()</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">ylabel</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">ylabel</span><span class="p">)</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Iteration Number&#39;</span><span class="p">)</span>

            <span class="n">coords</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">units</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">units</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="n">output_fn</span><span class="o">.</span><span class="n">units</span>
            <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
                <span class="n">y_data</span><span class="o">=</span><span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">output_fn</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">coord</span><span class="p">]]</span>
                <span class="n">x_data</span><span class="o">=</span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">output_fn</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">coord</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">raw</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                    <span class="n">plot_data</span><span class="o">=</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span><span class="n">y_data</span><span class="p">)</span>
                    <span class="n">pylab</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="n">a</span><span class="o">+</span><span class="s">&#39;(</span><span class="si">%.2f</span><span class="s">, </span><span class="si">%.2f</span><span class="s">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span><span class="n">plot_data</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.6f</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">)</span>


                <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span><span class="n">y_data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Unit (</span><span class="si">%.2f</span><span class="s">, </span><span class="si">%.2f</span><span class="s">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">)</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">ybounds</span>
                <span class="n">pylab</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">init_time</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="n">final_time</span><span class="p">,</span><span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">isint</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="o">=</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s">&#39;: &#39;</span><span class="o">+</span><span class="n">a</span>
            <span class="n">p</span><span class="o">.</span><span class="n">filename_suffix</span><span class="o">=</span><span class="n">a</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generate_figure</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>



<span class="c"># JABALERT: Should be updated to plot for a specified list of sheets,</span>
<span class="c"># and then the combination of all of them, so that it will work for</span>
<span class="c"># any network.  Will need to remove the simple_sheet_name and</span>
<span class="c"># complex_sheet_name parameters once that works.</span></div>
<div class="viewcode-block" id="plot_modulation_ratio"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.plot_modulation_ratio">[docs]</a><span class="k">class</span> <span class="nc">plot_modulation_ratio</span><span class="p">(</span><span class="n">PylabPlotCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function computes the modulation ratios of neurons in the</span>
<span class="sd">    specified sheets and plots their histograms. See</span>
<span class="sd">    analysis.vision.complexity for more info.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># JABALERT: All but the first argument should probably be Parameters</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fullmatrix</span><span class="p">,</span><span class="n">simple_sheet_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">complex_sheet_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">frange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="n">inclusive</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">topo.analysis.vision</span> <span class="kn">import</span> <span class="n">complexity</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">objects</span><span class="p">()</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">simple_sheet_name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">objects</span><span class="p">()</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">complex_sheet_name</span><span class="p">)):</span>
            <span class="n">v1s</span> <span class="o">=</span> <span class="n">complexity</span><span class="p">(</span><span class="n">fullmatrix</span><span class="p">[</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="n">simple_sheet_name</span><span class="p">]])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">v1c</span> <span class="o">=</span> <span class="n">complexity</span><span class="p">(</span><span class="n">fullmatrix</span><span class="p">[</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="p">[</span><span class="n">complex_sheet_name</span><span class="p">]])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="c">#double the number of complex cells to reflect large width of layer 2/3</span>
            <span class="n">v1c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">array</span><span class="p">(</span><span class="n">v1c</span><span class="p">),</span><span class="n">array</span><span class="p">(</span><span class="n">v1c</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">311</span><span class="p">)</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">v1s</span><span class="p">,</span><span class="n">bins</span><span class="p">)</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4100</span><span class="p">])</span>
	    <span class="n">n</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

	    <span class="n">n</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">312</span><span class="p">)</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">v1c</span><span class="p">,</span><span class="n">bins</span><span class="p">)</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4100</span><span class="p">])</span>
	    <span class="n">n</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

	    <span class="n">n</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">313</span><span class="p">)</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">array</span><span class="p">(</span><span class="n">v1s</span><span class="p">),</span><span class="n">array</span><span class="p">(</span><span class="n">v1c</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">bins</span><span class="p">)</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4100</span><span class="p">])</span>
	    <span class="n">n</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_figure</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="measure_position_pref"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.measure_position_pref">[docs]</a><span class="k">class</span> <span class="nc">measure_position_pref</span><span class="p">(</span><span class="n">PositionMeasurementCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Measure a position preference map by collating the response to patterns.&quot;&quot;&quot;</span>

    <span class="n">scale</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="n">width</span> <span class="o">=</span><span class="mf">1.0</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">height</span><span class="o">=</span><span class="mf">1.0</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">y_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">y_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">x_range</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="n">width</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">divisions</span><span class="p">,</span><span class="n">preference_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preference_fn</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">y_range</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="n">height</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">divisions</span><span class="p">,</span><span class="n">preference_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preference_fn</span><span class="p">)]</span>

</div>
<span class="kn">from</span> <span class="nn">topo.misc.distribution</span> <span class="kn">import</span> <span class="n">DSF_WeightedAverage</span>
<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Position Preference&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Preference Maps&quot;</span><span class="p">,</span>
           <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure preference for the X and Y position of a Gaussian.&#39;</span><span class="p">,</span>
           <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_position_pref</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span>
            <span class="n">preference_fn</span><span class="o">=</span><span class="n">DSF_WeightedAverage</span><span class="p">(</span> <span class="n">selectivity_scale</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">17.</span><span class="p">)</span> <span class="p">))],</span>
           <span class="n">plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">topographic_grid</span><span class="o">.</span><span class="n">instance</span><span class="p">()],</span>
           <span class="n">normalize</span><span class="o">=</span><span class="s">&#39;Individually&#39;</span><span class="p">)</span>

<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;X Preference&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;XPreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Y Preference&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;YPreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Position Preference&#39;</span><span class="p">,[(</span><span class="s">&#39;Red&#39;</span><span class="p">,</span><span class="s">&#39;XPreference&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s">&#39;Green&#39;</span><span class="p">,</span><span class="s">&#39;YPreference&#39;</span><span class="p">)])</span>



<div class="viewcode-block" id="measure_cog"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.measure_cog">[docs]</a><span class="k">class</span> <span class="nc">measure_cog</span><span class="p">(</span><span class="n">ParameterizedFunction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate center of gravity (CoG) for each CF of each unit in each CFSheet.</span>

<span class="sd">    Unlike measure_position_pref and other measure commands, this one</span>
<span class="sd">    does not work by collating the responses to a set of input patterns.</span>
<span class="sd">    Instead, the CoG is calculated directly from each set of incoming</span>
<span class="sd">    weights.  The CoG value thus is an indirect estimate of what</span>
<span class="sd">    patterns the neuron will prefer, but is not limited by the finite</span>
<span class="sd">    number of test patterns as the other measure commands are.</span>

<span class="sd">    Measures only one projection for each sheet, as specified by the</span>
<span class="sd">    proj_name parameter.  The default proj_name of &#39;&#39; selects the</span>
<span class="sd">    first non-self connection, which is usually useful to examine for</span>
<span class="sd">    simple feedforward networks, but will not necessarily be useful in</span>
<span class="sd">    other cases.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">proj_name</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Name of the projection to measure; the empty string means &#39;the first</span>
<span class="s">        non-self connection available&#39;.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>

        <span class="n">measured_sheets</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">CFSheet</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                           <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s">&#39;measure_maps&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="o">.</span><span class="n">measure_maps</span><span class="p">]</span>

        <span class="c"># Could easily be extended to measure CoG of all projections</span>
        <span class="c"># and e.g. register them using different names (e.g. &quot;Afferent</span>
        <span class="c"># XCoG&quot;), but then it&#39;s not clear how the PlotGroup would be</span>
        <span class="c"># able to find them automatically (as it currently supports</span>
        <span class="c"># only a fixed-named plot).</span>
        <span class="n">requested_proj</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">proj_name</span>
        <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="n">measured_sheets</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">proj</span> <span class="ow">in</span> <span class="n">sheet</span><span class="o">.</span><span class="n">in_connections</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">proj</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">requested_proj</span><span class="p">)</span> <span class="ow">or</span> \
                   <span class="p">(</span><span class="n">requested_proj</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">proj</span><span class="o">.</span><span class="n">src</span> <span class="o">!=</span> <span class="n">sheet</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_proj_cog</span><span class="p">(</span><span class="n">proj</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">requested_proj</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&quot;measure_cog: Measured </span><span class="si">%s</span><span class="s"> projection </span><span class="si">%s</span><span class="s"> from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
                              <span class="p">(</span><span class="n">proj</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">proj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">proj</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="k">break</span>


    <span class="k">def</span> <span class="nf">_update_proj_cog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">proj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Measure the CoG of the specified projection and register corresponding SheetViews.&quot;&quot;&quot;</span>

        <span class="n">sheet</span><span class="o">=</span><span class="n">proj</span><span class="o">.</span><span class="n">dest</span>
        <span class="n">rows</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="n">sheet</span><span class="o">.</span><span class="n">activity</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">xpref</span><span class="o">=</span><span class="n">zeros</span><span class="p">((</span><span class="n">rows</span><span class="p">,</span><span class="n">cols</span><span class="p">),</span><span class="n">Float</span><span class="p">)</span>
        <span class="n">ypref</span><span class="o">=</span><span class="n">zeros</span><span class="p">((</span><span class="n">rows</span><span class="p">,</span><span class="n">cols</span><span class="p">),</span><span class="n">Float</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
                <span class="n">cf</span><span class="o">=</span><span class="n">proj</span><span class="o">.</span><span class="n">cfs</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span>
                <span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">input_sheet_slice</span>
                <span class="n">row_centroid</span><span class="p">,</span><span class="n">col_centroid</span> <span class="o">=</span> <span class="n">centroid</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
                <span class="n">xcentroid</span><span class="p">,</span> <span class="n">ycentroid</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">matrix2sheet</span><span class="p">(</span>
                        <span class="n">r1</span><span class="o">+</span><span class="n">row_centroid</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span>
                        <span class="n">c1</span><span class="o">+</span><span class="n">col_centroid</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>

                <span class="n">xpref</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">=</span> <span class="n">xcentroid</span>
                <span class="n">ypref</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">=</span> <span class="n">ycentroid</span>

                <span class="n">sheet</span><span class="o">.</span><span class="n">sheet_views</span><span class="p">[</span><span class="s">&#39;XCoG&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">SheetView</span><span class="p">((</span><span class="n">xpref</span><span class="p">,</span><span class="n">sheet</span><span class="o">.</span><span class="n">bounds</span><span class="p">),</span> <span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                    <span class="n">sheet</span><span class="o">.</span><span class="n">precedence</span><span class="p">,</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span><span class="n">sheet</span><span class="o">.</span><span class="n">row_precedence</span><span class="p">)</span>

                <span class="n">sheet</span><span class="o">.</span><span class="n">sheet_views</span><span class="p">[</span><span class="s">&#39;YCoG&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">SheetView</span><span class="p">((</span><span class="n">ypref</span><span class="p">,</span><span class="n">sheet</span><span class="o">.</span><span class="n">bounds</span><span class="p">),</span> <span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                    <span class="n">sheet</span><span class="o">.</span><span class="n">precedence</span><span class="p">,</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span><span class="n">sheet</span><span class="o">.</span><span class="n">row_precedence</span><span class="p">)</span>

</div>
<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Center of Gravity&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Preference Maps&quot;</span><span class="p">,</span>
             <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure the center of gravity of each ConnectionField in a Projection.&#39;</span><span class="p">,</span>
             <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_cog</span><span class="o">.</span><span class="n">instance</span><span class="p">()],</span>
             <span class="n">plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">topographic_grid</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span><span class="n">xsheet_view_name</span><span class="o">=</span><span class="s">&quot;XCoG&quot;</span><span class="p">,</span><span class="n">ysheet_view_name</span><span class="o">=</span><span class="s">&quot;YCoG&quot;</span><span class="p">)],</span>
             <span class="n">normalize</span><span class="o">=</span><span class="s">&#39;Individually&#39;</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;X CoG&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;XCoG&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Y CoG&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;YCoG&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;CoG&#39;</span><span class="p">,[(</span><span class="s">&#39;Red&#39;</span><span class="p">,</span><span class="s">&#39;XCoG&#39;</span><span class="p">),(</span><span class="s">&#39;Green&#39;</span><span class="p">,</span><span class="s">&#39;YCoG&#39;</span><span class="p">)])</span>


<div class="viewcode-block" id="measure_or_tuning_fullfield"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.measure_or_tuning_fullfield">[docs]</a><span class="k">class</span> <span class="nc">measure_or_tuning_fullfield</span><span class="p">(</span><span class="n">FeatureCurveCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Measures orientation tuning curve(s) of a particular unit using a</span>
<span class="sd">    full-field sine grating stimulus.</span>

<span class="sd">    The curve can be plotted at various different values of the</span>
<span class="sd">    contrast (or actually any other parameter) of the stimulus.  If</span>
<span class="sd">    using contrast and the network contains an LGN layer, then one</span>
<span class="sd">    would usually specify michelson_contrast as the</span>
<span class="sd">    contrast_parameter. If there is no explicit LGN, then scale</span>
<span class="sd">    (offset=0.0) can be used to define the contrast.  Other relevant</span>
<span class="sd">    contrast definitions (or other parameters) can also be used,</span>
<span class="sd">    provided they are defined in PatternPresenter and the units</span>
<span class="sd">    parameter is changed as appropriate.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">coords</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Ignored; here just to suppress warning.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">pattern_presenter</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Callable</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="n">PatternPresenter</span><span class="p">(</span><span class="n">pattern_generator</span><span class="o">=</span><span class="n">SineGrating</span><span class="p">(),</span>
                                 <span class="n">contrast_parameter</span><span class="o">=</span><span class="s">&quot;michelson_contrast&quot;</span><span class="p">))</span>

</div>
<span class="n">create_plotgroup</span><span class="p">(</span><span class="n">template_plot_type</span><span class="o">=</span><span class="s">&quot;curve&quot;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Orientation Tuning Fullfield&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Tuning Curves&quot;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            Plot orientation tuning curves for a specific unit, measured using full-field sine gratings.</span>
<span class="s">            Although the data takes a long time to collect, once it is ready the plots</span>
<span class="s">            are available immediately for any unit.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_or_tuning_fullfield</span><span class="o">.</span><span class="n">instance</span><span class="p">()],</span>
        <span class="n">plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">cyclic_tuning_curve</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span><span class="n">x_axis</span><span class="o">=</span><span class="s">&quot;orientation&quot;</span><span class="p">)])</span>



<div class="viewcode-block" id="measure_or_tuning"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.measure_or_tuning">[docs]</a><span class="k">class</span> <span class="nc">measure_or_tuning</span><span class="p">(</span><span class="n">UnitCurveCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Measures orientation tuning curve(s) of a particular unit.</span>

<span class="sd">    Uses a circular sine grating patch as the stimulus on the</span>
<span class="sd">    retina.</span>

<span class="sd">    The curve can be plotted at various different values of the</span>
<span class="sd">    contrast (or actually any other parameter) of the stimulus.  If</span>
<span class="sd">    using contrast and the network contains an LGN layer, then one</span>
<span class="sd">    would usually specify weber_contrast as the contrast_parameter. If</span>
<span class="sd">    there is no explicit LGN, then scale (offset=0.0) can be used to</span>
<span class="sd">    define the contrast.  Other relevant contrast definitions (or</span>
<span class="sd">    other parameters) can also be used, provided they are defined in</span>
<span class="sd">    PatternPresenter and the units parameter is changed as</span>
<span class="sd">    appropriate.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">num_orientation</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">static_parameters</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="s">&quot;y&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">(</span><span class="s">&#39;sheet&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compute_default</span><span class="p">()</span>
        <span class="n">sheet</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">sheet</span>

        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheetview_unit</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="n">coord</span><span class="p">,</span><span class="s">&#39;XPreference&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheetview_unit</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="n">coord</span><span class="p">,</span><span class="s">&#39;YPreference&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compute_curves</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">sheet</span><span class="p">)</span>

</div>
<span class="n">create_plotgroup</span><span class="p">(</span><span class="n">template_plot_type</span><span class="o">=</span><span class="s">&quot;curve&quot;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Orientation Tuning&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Tuning Curves&quot;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            Measure orientation tuning for a specific unit at different contrasts,</span>
<span class="s">            using a pattern chosen to match the preferences of that unit.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_or_tuning</span><span class="o">.</span><span class="n">instance</span><span class="p">()],</span>
        <span class="n">plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">cyclic_tuning_curve</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span><span class="n">x_axis</span><span class="o">=</span><span class="s">&quot;orientation&quot;</span><span class="p">)],</span>
        <span class="n">prerequisites</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;XPreference&#39;</span><span class="p">])</span>



<span class="c"># JABALERT: Is there some reason not to call it measure_size_tuning?</span>
<div class="viewcode-block" id="measure_size_response"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.measure_size_response">[docs]</a><span class="k">class</span> <span class="nc">measure_size_response</span><span class="p">(</span><span class="n">UnitCurveCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Measure receptive field size of one unit of a sheet.</span>

<span class="sd">    Uses an expanding circular sine grating stimulus at the preferred</span>
<span class="sd">    orientation and retinal position of the specified unit.</span>
<span class="sd">    Orientation and position preference must be calulated before</span>
<span class="sd">    measuring size response.</span>

<span class="sd">    The curve can be plotted at various different values of the</span>
<span class="sd">    contrast (or actually any other parameter) of the stimulus.  If</span>
<span class="sd">    using contrast and the network contains an LGN layer, then one</span>
<span class="sd">    would usually specify weber_contrast as the contrast_parameter. If</span>
<span class="sd">    there is no explicit LGN, then scale (offset=0.0) can be used to</span>
<span class="sd">    define the contrast.  Other relevant contrast definitions (or</span>
<span class="sd">    other parameters) can also be used, provided they are defined in</span>
<span class="sd">    PatternPresenter and the units parameter is changed as</span>
<span class="sd">    appropriate.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">size</span><span class="o">=</span><span class="bp">None</span> <span class="c"># Disabled unused parameter</span>

    <span class="n">static_parameters</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;orientation&quot;</span><span class="p">,</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="s">&quot;y&quot;</span><span class="p">])</span>

    <span class="n">num_sizes</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span>
                              <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Number of different sizes to test.&quot;</span><span class="p">)</span>

    <span class="n">max_size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span>
                              <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Maximum extent of the grating&quot;</span><span class="p">)</span>

    <span class="n">x_axis</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;size&#39;</span><span class="p">,</span><span class="n">constant</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">(</span><span class="s">&#39;sheet&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compute_default</span><span class="p">()</span>
        <span class="n">sheet</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">sheet</span>

        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
            <span class="c"># Orientations are stored as a normalized value beween 0</span>
            <span class="c"># and 1, so we scale them by pi to get the true orientations.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="o">=</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheetview_unit</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="n">coord</span><span class="p">,</span><span class="s">&#39;OrientationPreference&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheetview_unit</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="n">coord</span><span class="p">,</span><span class="s">&#39;XPreference&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheetview_unit</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="n">coord</span><span class="p">,</span><span class="s">&#39;YPreference&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compute_curves</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">sheet</span><span class="p">)</span>


    <span class="c"># Why not vary frequency too?  Usually it&#39;s just one number, but it could be otherwise.</span>
    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;phase&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_phase</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;frequency&quot;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">frequencies</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_sizes</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">False</span><span class="p">)]</span>

</div>
<span class="n">create_plotgroup</span><span class="p">(</span><span class="n">template_plot_type</span><span class="o">=</span><span class="s">&quot;curve&quot;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Size Tuning&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Tuning Curves&quot;</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure the size preference for a specific unit.&#39;</span><span class="p">,</span>
        <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_size_response</span><span class="o">.</span><span class="n">instance</span><span class="p">()],</span>
        <span class="n">plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">tuning_curve</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span><span class="n">x_axis</span><span class="o">=</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s">&quot;Diameter of stimulus&quot;</span><span class="p">)],</span>
        <span class="n">prerequisites</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;OrientationPreference&#39;</span><span class="p">,</span><span class="s">&#39;XPreference&#39;</span><span class="p">])</span>



<div class="viewcode-block" id="measure_contrast_response"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.measure_contrast_response">[docs]</a><span class="k">class</span> <span class="nc">measure_contrast_response</span><span class="p">(</span><span class="n">UnitCurveCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Measures contrast response curves for a particular unit.</span>

<span class="sd">    Uses a circular sine grating stimulus at the preferred</span>
<span class="sd">    orientation and retinal position of the specified unit.</span>
<span class="sd">    Orientation and position preference must be calulated before</span>
<span class="sd">    measuring contrast response.</span>

<span class="sd">    The curve can be plotted at various different values of the</span>
<span class="sd">    contrast (or actually any other parameter) of the stimulus.  If</span>
<span class="sd">    using contrast and the network contains an LGN layer, then one</span>
<span class="sd">    would usually specify weber_contrast as the contrast_parameter. If</span>
<span class="sd">    there is no explicit LGN, then scale (offset=0.0) can be used to</span>
<span class="sd">    define the contrast.  Other relevant contrast definitions (or</span>
<span class="sd">    other parameters) can also be used, provided they are defined in</span>
<span class="sd">    PatternPresenter and the units parameter is changed as</span>
<span class="sd">    appropriate.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">static_parameters</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="s">&quot;y&quot;</span><span class="p">])</span>

    <span class="n">contrasts</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>

    <span class="n">relative_orientations</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">x_axis</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;contrast&#39;</span><span class="p">,</span><span class="n">constant</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">units</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&quot; rad&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">(</span><span class="s">&#39;sheet&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compute_default</span><span class="p">()</span>
        <span class="n">sheet</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">sheet</span>

        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
            <span class="n">orientation</span><span class="o">=</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheetview_unit</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="n">coord</span><span class="p">,</span><span class="s">&#39;OrientationPreference&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curve_parameters</span><span class="o">=</span><span class="p">[{</span><span class="s">&quot;orientation&quot;</span><span class="p">:</span><span class="n">orientation</span><span class="o">+</span><span class="n">ro</span><span class="p">}</span> <span class="k">for</span> <span class="n">ro</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relative_orientations</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheetview_unit</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="n">coord</span><span class="p">,</span><span class="s">&#39;XPreference&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheetview_unit</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="n">coord</span><span class="p">,</span><span class="s">&#39;YPreference&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_compute_curves</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">sheet</span><span class="p">,</span><span class="n">val_format</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%.4f</span><span class="s">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;phase&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_phase</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;frequency&quot;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">frequencies</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;contrast&quot;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">contrasts</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">False</span><span class="p">)]</span>

</div>
<span class="n">create_plotgroup</span><span class="p">(</span><span class="n">template_plot_type</span><span class="o">=</span><span class="s">&quot;curve&quot;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Contrast Response&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Tuning Curves&quot;</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure the contrast response function for a specific unit.&#39;</span><span class="p">,</span>
        <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_contrast_response</span><span class="o">.</span><span class="n">instance</span><span class="p">()],</span>
        <span class="n">plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">tuning_curve</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span><span class="n">x_axis</span><span class="o">=</span><span class="s">&quot;contrast&quot;</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s">&quot;%&quot;</span><span class="p">)],</span>
        <span class="n">prerequisites</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;OrientationPreference&#39;</span><span class="p">,</span><span class="s">&#39;XPreference&#39;</span><span class="p">])</span>



<div class="viewcode-block" id="measure_orientation_contrast"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.pylabplot-module.html#topo.command.pylabplot.measure_orientation_contrast">[docs]</a><span class="k">class</span> <span class="nc">measure_orientation_contrast</span><span class="p">(</span><span class="n">UnitCurveCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Measures the response to a center sine grating disk and a surround</span>
<span class="sd">    sine grating ring at different contrasts of the central disk.</span>

<span class="sd">    The central disk is set to the preferred orientation of the unit</span>
<span class="sd">    to be measured. The surround disk orientation (relative to the</span>
<span class="sd">    central grating) and contrast can be varied, as can the size of</span>
<span class="sd">    both disks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pattern_presenter</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Callable</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="n">PatternPresenter</span><span class="p">(</span><span class="n">pattern_generator</span><span class="o">=</span><span class="n">OrientationContrast</span><span class="p">(),</span>
                                 <span class="n">contrast_parameter</span><span class="o">=</span><span class="s">&quot;weber_contrast&quot;</span><span class="p">))</span>

    <span class="n">size</span><span class="o">=</span><span class="bp">None</span> <span class="c"># Disabled unused parameter</span>
    <span class="c"># Maybe instead of the below, use size and some relative parameter, to allow easy scaling?</span>

    <span class="n">sizecenter</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        The size of the central pattern to present.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">sizesurround</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        The size of the surround pattern to present.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">thickness</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Ring thickness.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">contrastsurround</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Contrast of the surround.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">contrastcenter</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Contrast of the center.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">x_axis</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;orientationsurround&#39;</span><span class="p">,</span><span class="n">constant</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">orientation_center</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Orientation of the center grating patch&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">units</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&quot;%&quot;</span><span class="p">)</span>

    <span class="n">static_parameters</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="s">&quot;sizecenter&quot;</span><span class="p">,</span><span class="s">&quot;sizesurround&quot;</span><span class="p">,</span><span class="s">&quot;orientationcenter&quot;</span><span class="p">,</span><span class="s">&quot;thickness&quot;</span><span class="p">,</span><span class="s">&quot;contrastcenter&quot;</span><span class="p">])</span>

    <span class="n">curve_parameters</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">Parameter</span><span class="p">([{</span><span class="s">&quot;contrastsurround&quot;</span><span class="p">:</span><span class="mi">30</span><span class="p">},{</span><span class="s">&quot;contrastsurround&quot;</span><span class="p">:</span><span class="mi">60</span><span class="p">},{</span><span class="s">&quot;contrastsurround&quot;</span><span class="p">:</span><span class="mi">80</span><span class="p">},{</span><span class="s">&quot;contrastsurround&quot;</span><span class="p">:</span><span class="mi">90</span><span class="p">}],</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        List of parameter values for which to measure a curve.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">or_surrounds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">(</span><span class="s">&#39;sheet&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compute_default</span><span class="p">()</span>
        <span class="n">sheet</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">sheet</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">or_surrounds</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">orientation</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">orientation_center</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orientationcenter</span><span class="o">=</span><span class="n">orientation</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">num_orientation</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">or_surrounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orientation</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_orientation</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheetview_unit</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="n">coord</span><span class="p">,</span><span class="s">&#39;XPreference&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sheetview_unit</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="n">coord</span><span class="p">,</span><span class="s">&#39;YPreference&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_compute_curves</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">sheet</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;phase&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_phase</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    	 	<span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;frequency&quot;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">frequencies</span><span class="p">),</span>
		<span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;orientationsurround&quot;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">or_surrounds</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">)]</span>
</div>
<span class="n">create_plotgroup</span><span class="p">(</span><span class="n">template_plot_type</span><span class="o">=</span><span class="s">&quot;curve&quot;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Orientation Contrast&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Tuning Curves&quot;</span><span class="p">,</span>
                 <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure the response of one unit to a center and surround sine grating disk.&#39;</span><span class="p">,</span>
                 <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_orientation_contrast</span><span class="o">.</span><span class="n">instance</span><span class="p">()],</span>
                 <span class="n">plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">tuning_curve</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span><span class="n">x_axis</span><span class="o">=</span><span class="s">&quot;orientationsurround&quot;</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s">&quot;%&quot;</span><span class="p">)],</span>
                 <span class="n">prerequisites</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;OrientationPreference&#39;</span><span class="p">,</span><span class="s">&#39;XPreference&#39;</span><span class="p">])</span>



<span class="k">class</span> <span class="nc">test_measure</span><span class="p">(</span><span class="n">UnitCurveCommand</span><span class="p">):</span>

    <span class="n">static_parameters</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="s">&quot;y&quot;</span><span class="p">])</span>

    <span class="n">x_axis</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;contrast&#39;</span><span class="p">,</span><span class="n">constant</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">units</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&quot; rad&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">(</span><span class="s">&#39;sheet&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compute_default</span><span class="p">()</span>
        <span class="n">sheet</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">sheet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compute_curves</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">sheet</span><span class="p">,</span><span class="n">val_format</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%.4f</span><span class="s">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;orientation&quot;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">]</span><span class="o">*</span><span class="mi">22</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    		<span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;contrast&quot;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">],</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">False</span><span class="p">)]</span>

<span class="kn">import</span> <span class="nn">types</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">ParameterizedFunction</span><span class="p">))</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">__name__</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)]))</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/topo-banner7.png" alt="Logo"/>
            </a></p>
<ul class="global-toc">
<li><a href="../../../index.html">Home</a></li>
<li><a href="../../../News/index.html">News</a></li>
<li><a href="../../../Downloads/index.html">Downloads</a></li>
<li><a href="../../../Tutorials/index.html">Tutorials</a></li>
<li><a href="../../../User_Manual/index.html">User Manual</a></li>
<li><a href="../../../Reference_Manual/index.html">Reference Manual</a></li>
<li><a href="../../../Developer_Manual/index.html">Developer Manual</a></li>
<li><a href="../../../Forums/index.html">Forums</a></li>
<li><a href="../../../Team_Members/index.html">Team Members</a></li>
<li><a href="../../../Future_Work/index.html">Future Work</a></li>
<li><a href="../../../FAQ/index.html">FAQ</a></li>
<li><a href="../../../Links/index.html">Links</a></li>
<li><a href="../../../Home/pubs.html">Publications</a></li>
</ul>
<h3><a href="../../../index.html">Table Of Contents</a></h3>


<h3>This Page</h3>
<ul class="this-page-menu">
	<li><a	href="https://github.com/wiktr/topographica/edit/doc/doc/_modules/topo/command/pylabplot.rst" rel="nofollow">Edit on GitHub</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
<li><a href="../../../index.html">Home</a></li>
<li><a href="../../../Downloads/index.html">Downloads</a></li>
<li><a href="../../../Tutorials/index.html">Tutorials</a></li>
<li><a href="../../../User_Manual/index.html">User Manual</a></li>


<li><ul class="parents">



          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../command.html" >topo.command</a> &raquo;</li>

</ul></li>


      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, IOAM.
      Last updated on May 09, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>