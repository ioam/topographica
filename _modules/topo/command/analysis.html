
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>topo.command.analysis &mdash; The Topographica Neural Map Simulator</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/topo.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.98',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/topo.js"></script>
    <link rel="top" title="The Topographica Neural Map Simulator" href="../../../index.html" />
    <link rel="up" title="topo.command" href="../command.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
<li><a href="../../../index.html">Home</a></li>
<li><a href="../../../Downloads/index.html">Downloads</a></li>
<li><a href="../../../Tutorials/index.html">Tutorials</a></li>
<li><a href="../../../User_Manual/index.html">User Manual</a></li>


<li><ul class="parents">



          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../command.html" accesskey="U">topo.command</a> &raquo;</li>

</ul></li>


      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for topo.command.analysis</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">User-level analysis commands, typically for measuring or generating SheetViews.</span>

<span class="sd">Most of this file consists of commands for creating SheetViews, paired</span>
<span class="sd">with a template for how to construct plots from these SheetViews.</span>

<span class="sd">For instance, the implementation of Activity plots consists of the</span>
<span class="sd">update_activity() command plus the Activity PlotGroupTemplate.  The</span>
<span class="sd">update_activity() command reads the activity array of each Sheet and</span>
<span class="sd">makes a corresponding SheetView to put in the Sheet&#39;s sheet_views</span>
<span class="sd">dictionary, while the Activity PlotGroupTemplate specifies which</span>
<span class="sd">SheetViews should be plotted in which combination.  See the help for</span>
<span class="sd">PlotGroupTemplate for more information.</span>

<span class="sd">Some of the commands are ordinary Python functions, but the rest are</span>
<span class="sd">ParameterizedFunctions, which act like Python functions but support</span>
<span class="sd">Parameters with defaults, bounds, inheritance, etc.  These commands</span>
<span class="sd">are usually grouped together using inheritance so that they share a</span>
<span class="sd">set of parameters and some code, and only the bits that are specific</span>
<span class="sd">to that particular plot or analysis appear below.  See the</span>
<span class="sd">superclasses for the rest of the parameters and code.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">Image</span><span class="o">,</span><span class="nn">ImageDraw</span>

<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">from</span> <span class="nn">numpy.oldnumeric</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">maximum</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">nonzero</span><span class="p">,</span> <span class="nb">round</span><span class="p">,</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="n">ceil</span>

<span class="kn">import</span> <span class="nn">param</span>
<span class="kn">from</span> <span class="nn">param.parameterized</span> <span class="kn">import</span> <span class="n">ParameterizedFunction</span>
<span class="kn">from</span> <span class="nn">param.parameterized</span> <span class="kn">import</span> <span class="n">ParamOverrides</span>

<span class="kn">import</span> <span class="nn">topo</span>
<span class="kn">from</span> <span class="nn">topo.base.cf</span> <span class="kn">import</span> <span class="n">Projection</span>
<span class="kn">from</span> <span class="nn">topo.base.sheet</span> <span class="kn">import</span> <span class="n">Sheet</span>
<span class="kn">from</span> <span class="nn">topo.sheet</span> <span class="kn">import</span> <span class="n">GeneratorSheet</span>
<span class="kn">from</span> <span class="nn">topo.base.sheetview</span> <span class="kn">import</span> <span class="n">SheetView</span>
<span class="kn">from</span> <span class="nn">topo.misc.distribution</span> <span class="kn">import</span> <span class="n">Distribution</span><span class="p">,</span> <span class="n">DistributionStatisticFn</span>
<span class="kn">from</span> <span class="nn">topo.misc.distribution</span> <span class="kn">import</span> <span class="n">DSF_MaxValue</span><span class="p">,</span> <span class="n">DSF_BimodalPeaks</span>
<span class="kn">from</span> <span class="nn">topo.misc.distribution</span> <span class="kn">import</span> <span class="n">DSF_WeightedAverage</span><span class="p">,</span> <span class="n">DSF_VonMisesFit</span><span class="p">,</span> <span class="n">DSF_BimodalVonMisesFit</span>
<span class="kn">from</span> <span class="nn">topo.pattern</span> <span class="kn">import</span> <span class="n">GaussiansCorner</span><span class="p">,</span> <span class="n">Gaussian</span><span class="p">,</span> <span class="n">RawRectangle</span><span class="p">,</span> <span class="n">Composite</span><span class="p">,</span> <span class="n">Constant</span>
<span class="kn">from</span> <span class="nn">topo.analysis.featureresponses</span> <span class="kn">import</span> <span class="n">ReverseCorrelation</span>
<span class="kn">from</span> <span class="nn">topo.plotting.plotgroup</span> <span class="kn">import</span> <span class="n">create_plotgroup</span><span class="p">,</span> <span class="n">plotgroups</span>

<span class="kn">from</span> <span class="nn">topo.plotting.plotgroup</span> <span class="kn">import</span> <span class="n">UnitMeasurementCommand</span><span class="p">,</span><span class="n">ProjectionSheetMeasurementCommand</span>
<span class="kn">from</span> <span class="nn">topo.analysis.featureresponses</span> <span class="kn">import</span> <span class="n">Feature</span><span class="p">,</span> <span class="n">PatternPresenter</span><span class="p">,</span> <span class="n">MeasureResponseCommand</span>
<span class="kn">from</span> <span class="nn">topo.analysis.featureresponses</span> <span class="kn">import</span> <span class="n">SinusoidalMeasureResponseCommand</span><span class="p">,</span> <span class="n">PositionMeasurementCommand</span><span class="p">,</span> <span class="n">SingleInputResponseCommand</span>
<span class="kn">from</span> <span class="nn">topo.base.patterngenerator</span> <span class="kn">import</span> <span class="n">PatternGenerator</span>
<span class="kn">from</span> <span class="nn">topo.command</span> <span class="kn">import</span> <span class="n">pattern_present</span>

<span class="kn">from</span> <span class="nn">topo.misc.patternfn</span> <span class="kn">import</span> <span class="n">line</span>


<span class="c"># Helper function for save_plotgroup</span>
<span class="k">def</span> <span class="nf">_equivalent_for_plotgroup_update</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function for save_plotgroup.</span>

<span class="sd">    Comparison operator for deciding whether make_plots(update==False) is</span>
<span class="sd">    safe for one plotgroup if the other has already been updated.</span>

<span class="sd">    Treats plotgroups as the same if the specified list of attributes</span>
<span class="sd">    (if present) match in both plotgroups.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">attrs_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;pre_plot_hooks&#39;</span><span class="p">,</span><span class="s">&#39;keyname&#39;</span><span class="p">,</span><span class="s">&#39;sheet&#39;</span><span class="p">,</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="s">&#39;projection&#39;</span><span class="p">,</span><span class="s">&#39;input_sheet&#39;</span><span class="p">,</span><span class="s">&#39;density&#39;</span><span class="p">,</span><span class="s">&#39;coords&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attrs_to_check</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span><span class="n">a</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span><span class="n">a</span><span class="p">)):</span>
                <span class="k">return</span> <span class="bp">False</span>

    <span class="k">return</span> <span class="bp">True</span>



<div class="viewcode-block" id="save_plotgroup"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.save_plotgroup">[docs]</a><span class="k">class</span> <span class="nc">save_plotgroup</span><span class="p">(</span><span class="n">ParameterizedFunction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenience command for saving a set of plots to disk.  Examples:</span>

<span class="sd">      save_plotgroup(&quot;Activity&quot;)</span>
<span class="sd">      save_plotgroup(&quot;Orientation Preference&quot;)</span>
<span class="sd">      save_plotgroup(&quot;Projection&quot;,projection=topo.sim[&#39;V1&#39;].projections(&#39;Afferent&#39;))</span>

<span class="sd">    Some plotgroups accept optional parameters, which can be passed</span>
<span class="sd">    like projection above.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">equivalence_fn</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Callable</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">_equivalent_for_plotgroup_update</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Function to call on plotgroups p1,p2 to determine if calling pre_plot_hooks</span>
<span class="s">        on one of them is sufficient to update both plots.  Should return False</span>
<span class="s">        unless the commands are exact equivalents, including all relevant parameters.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">use_cached_results</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        If True, will use the equivalence_fn to determine cases where</span>
<span class="s">        the pre_plot_hooks for a plotgroup can safely be skipped, to</span>
<span class="s">        avoid lengthy redundant computation.  Should usually be</span>
<span class="s">        False for safety, but can be enabled for e.g. batch mode</span>
<span class="s">        runs using a related batch of plots.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">saver_params</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">{},</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Optional parameters to pass to the underlying PlotFileSaver object.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="c"># Class variables to cache values from previous invocations</span>
    <span class="n">previous_time</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">previous_plotgroups</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">,</span><span class="n">allow_extra_keywords</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">plotgroup</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">plotgroups</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>

        <span class="c"># JABALERT: Why does a Projection plot need a Sheet parameter?</span>
        <span class="c"># CB: It shouldn&#39;t, of course, since we know the sheet when we have</span>
        <span class="c"># the projection object - it&#39;s just leftover from when we passed the</span>
        <span class="c"># names instead. There should be an ALERT already about this somewhere</span>
        <span class="c"># in projectionpanel.py or plotgroup.py (both need to be changed).</span>
        <span class="k">if</span> <span class="s">&#39;projection&#39;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">plotgroup</span><span class="p">,</span><span class="s">&#39;sheet&#39;</span><span class="p">,</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;projection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dest</span><span class="p">)</span>

        <span class="n">plotgroup</span><span class="o">.</span><span class="n">_set_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c"># Specified parameters that aren&#39;t parameters of</span>
        <span class="c"># save_plotgroup() are set on the plotgroup</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">extra_keywords</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">plotgroup</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>

        <span class="c"># Reset plot cache when time changes</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_time</span><span class="p">[:]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_plotgroups</span><span class="p">[:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

        <span class="c"># Skip update step if equivalent to prior command at this sim time</span>
        <span class="n">update</span><span class="o">=</span><span class="bp">True</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">use_cached_results</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_plotgroups</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">equivalence_fn</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">plotgroup</span><span class="p">):</span>
                    <span class="n">update</span><span class="o">=</span><span class="bp">False</span>
                    <span class="k">break</span>

        <span class="n">keywords</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">param</span><span class="o">.</span><span class="n">Parameterized</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">extra_keywords</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">plot_description</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%s%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">plotgroup</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s">&quot; &quot;</span> <span class="k">if</span> <span class="n">keywords</span> <span class="k">else</span> <span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">keywords</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_plotgroups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plotgroup</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: Running pre_plot_hooks&quot;</span> <span class="o">%</span> <span class="n">plot_description</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: Using cached results from pre_plot_hooks&quot;</span> <span class="o">%</span> <span class="n">plot_description</span><span class="p">)</span>

        <span class="n">plotgroup</span><span class="o">.</span><span class="n">make_plots</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="n">update</span><span class="p">)</span>
        <span class="n">plotgroup</span><span class="o">.</span><span class="n">filesaver</span><span class="o">.</span><span class="n">save_to_disk</span><span class="p">(</span><span class="o">**</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">saver_params</span><span class="p">))</span>


</div>
<div class="viewcode-block" id="decode_feature"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.decode_feature">[docs]</a><span class="k">def</span> <span class="nf">decode_feature</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">preference_map</span> <span class="o">=</span> <span class="s">&quot;OrientationPreference&quot;</span><span class="p">,</span> <span class="n">axis_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">weighted_average</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cropfn</span><span class="o">=</span><span class="k">lambda</span><span class="p">(</span><span class="n">x</span><span class="p">):</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate the value of a feature from the current activity pattern on a sheet.</span>

<span class="sd">    The specified preference_map should be measured before this</span>
<span class="sd">    function is called.</span>

<span class="sd">    If weighted_average is False, the feature value returned is the</span>
<span class="sd">    value of the preference_map at the maximally active location.</span>

<span class="sd">    If weighted_average is True, the feature value is estimated by</span>
<span class="sd">    weighting the preference_map by the current activity level, and</span>
<span class="sd">    averaging the result across all units in the sheet.  The</span>
<span class="sd">    axis_bounds specify the allowable range of the feature values in</span>
<span class="sd">    the preference_map.  If cyclic is true, a vector average is used;</span>
<span class="sd">    otherwise an arithmetic weighted average is used.</span>

<span class="sd">    For instance, if preference_map is OrientationPreference (a cyclic</span>
<span class="sd">    quantity), then the result will be the vector average of the</span>
<span class="sd">    activated orientations.  For an orientation map this value should</span>
<span class="sd">    be an estimate of the orientation present on the input.</span>

<span class="sd">    If desired, a cropfn can be supplied that will narrow the analysis</span>
<span class="sd">    down to a specific region of the array; this function will be</span>
<span class="sd">    applied to the preference_map and to the activity array before</span>
<span class="sd">    decoding.  Examples:</span>

<span class="sd">    Decode whole area:</span>

<span class="sd">       decode_feature(topo.sim[&quot;V1&quot;])</span>

<span class="sd">    Decode left half only:</span>

<span class="sd">       r,c = topo.sim[&quot;V1&quot;].activity.shape</span>
<span class="sd">       lefthalf  = lambda(x): x[:,0:c/2]</span>
<span class="sd">       righthalf = lambda(x): x[:,c/2:]</span>

<span class="sd">       decode_feature(topo.sim[&quot;V1&quot;], cropfn=lefthalf)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">Distribution</span><span class="p">(</span><span class="n">axis_bounds</span><span class="p">,</span> <span class="n">cyclic</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">preference_map</span> <span class="ow">in</span> <span class="n">sheet</span><span class="o">.</span><span class="n">sheet_views</span><span class="p">):</span>
        <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">preference_map</span> <span class="o">+</span> <span class="s">&quot; should be measured before calling decode_feature.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">sheet_views</span><span class="p">[</span><span class="n">preference_map</span><span class="p">]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cropfn</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">view</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
                         <span class="n">cropfn</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">activity</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()):</span> <span class="n">d</span><span class="o">.</span><span class="n">add</span><span class="p">({</span><span class="n">p</span><span class="p">:</span><span class="n">a</span><span class="p">})</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">DSF_WeightedAverage</span><span class="p">()(</span><span class="n">d</span><span class="p">)</span> <span class="k">if</span> <span class="n">weighted_average</span> <span class="k">else</span> <span class="n">DSF_MaxValue</span><span class="p">()(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">][</span><span class="s">&#39;preference&#39;</span><span class="p">]</span>


</div>
<div class="viewcode-block" id="update_activity"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.update_activity">[docs]</a><span class="k">def</span> <span class="nf">update_activity</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a map of neural activity available for each sheet, for use in template-based plots.</span>

<span class="sd">    This command simply asks each sheet for a copy of its activity</span>
<span class="sd">    matrix, and then makes it available for plotting.  Of course, for</span>
<span class="sd">    some sheets providing this information may be non-trivial, e.g. if</span>
<span class="sd">    they need to average over recent spiking activity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">Sheet</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">activity_copy</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">activity</span><span class="p">)</span>
        <span class="n">new_view</span> <span class="o">=</span> <span class="n">SheetView</span><span class="p">((</span><span class="n">activity_copy</span><span class="p">,</span><span class="n">sheet</span><span class="o">.</span><span class="n">bounds</span><span class="p">),</span>
                              <span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">sheet</span><span class="o">.</span><span class="n">precedence</span><span class="p">,</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span><span class="n">sheet</span><span class="o">.</span><span class="n">row_precedence</span><span class="p">)</span>
        <span class="n">sheet</span><span class="o">.</span><span class="n">sheet_views</span><span class="p">[</span><span class="s">&#39;Activity&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">new_view</span>

</div>
<span class="n">pg</span> <span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Activity&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&#39;Basic&#39;</span><span class="p">,</span>
             <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Plot the activity for all Sheets.&#39;</span><span class="p">,</span> <span class="n">auto_refresh</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">update_activity</span><span class="p">],</span> <span class="n">plot_immediately</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Activity&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;Activity&#39;</span><span class="p">)])</span>


<div class="viewcode-block" id="update_rgb_activities"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.update_rgb_activities">[docs]</a><span class="k">def</span> <span class="nf">update_rgb_activities</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make available Red, Green, and Blue activity matrices for all appropriate sheets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">Sheet</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Red&#39;</span><span class="p">,</span><span class="s">&#39;Green&#39;</span><span class="p">,</span><span class="s">&#39;Blue&#39;</span><span class="p">]:</span>
            <span class="c"># should this ensure all of r,g,b are present?</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="s">&#39;activity_</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
                <span class="n">activity_copy</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span><span class="s">&#39;activity_</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">new_view</span> <span class="o">=</span> <span class="n">SheetView</span><span class="p">((</span><span class="n">activity_copy</span><span class="p">,</span><span class="n">sheet</span><span class="o">.</span><span class="n">bounds</span><span class="p">),</span>
                                     <span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">sheet</span><span class="o">.</span><span class="n">precedence</span><span class="p">,</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span><span class="n">sheet</span><span class="o">.</span><span class="n">row_precedence</span><span class="p">)</span>
                <span class="n">sheet</span><span class="o">.</span><span class="n">sheet_views</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">Activity&#39;</span><span class="o">%</span><span class="n">c</span><span class="p">]</span><span class="o">=</span><span class="n">new_view</span>

</div>
<span class="n">pg</span> <span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;RGB&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&#39;Other&#39;</span><span class="p">,</span>
             <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Combine and plot the red, green, and blue activity for all appropriate Sheets.&#39;</span><span class="p">,</span> <span class="n">auto_refresh</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">update_rgb_activities</span><span class="p">],</span> <span class="n">plot_immediately</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;RGB&#39;</span><span class="p">,[(</span><span class="s">&#39;Red&#39;</span><span class="p">,</span><span class="s">&#39;RedActivity&#39;</span><span class="p">),(</span><span class="s">&#39;Green&#39;</span><span class="p">,</span><span class="s">&#39;GreenActivity&#39;</span><span class="p">),(</span><span class="s">&#39;Blue&#39;</span><span class="p">,</span><span class="s">&#39;BlueActivity&#39;</span><span class="p">)])</span>



<div class="viewcode-block" id="update_connectionfields"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.update_connectionfields">[docs]</a><span class="k">class</span> <span class="nc">update_connectionfields</span><span class="p">(</span><span class="n">UnitMeasurementCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A callable Parameterized command for measuring or plotting a unit from a Projection.&quot;&quot;&quot;</span>

    <span class="c"># Force plotting of all CFs, not just one Projection</span>
    <span class="n">projection</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ObjectSelector</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">constant</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</div>
<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Connection Fields&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Basic&quot;</span><span class="p">,</span>
                     <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Plot the weight strength in each ConnectionField of a specific unit of a Sheet.&#39;</span><span class="p">,</span>
                     <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">update_connectionfields</span><span class="p">],</span>
                     <span class="n">plot_immediately</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s">&#39;Individually&#39;</span><span class="p">,</span> <span class="n">situate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Connection Fields&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;Weights&#39;</span><span class="p">)])</span>



<div class="viewcode-block" id="update_projection"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.update_projection">[docs]</a><span class="k">class</span> <span class="nc">update_projection</span><span class="p">(</span><span class="n">UnitMeasurementCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A callable Parameterized command for measuring or plotting units from a Projection.&quot;&quot;&quot;</span>

</div>
<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Projection&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Basic&quot;</span><span class="p">,</span>
           <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Plot the weights of an array of ConnectionFields in a Projection.&#39;</span><span class="p">,</span>
           <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">update_projection</span><span class="p">],</span>
           <span class="n">plot_immediately</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s">&#39;Individually&#39;</span><span class="p">,</span><span class="n">sheet_coords</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Projection&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;Weights&#39;</span><span class="p">)])</span>



<div class="viewcode-block" id="update_projectionactivity"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.update_projectionactivity">[docs]</a><span class="k">class</span> <span class="nc">update_projectionactivity</span><span class="p">(</span><span class="n">ProjectionSheetMeasurementCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add SheetViews for all of the Projections of the ProjectionSheet</span>
<span class="sd">    specified by the sheet parameter, for use in template-based plots.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">(</span><span class="s">&#39;sheet&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compute_default</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">sheet</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">conn</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">in_connections</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">Projection</span><span class="p">):</span>
                    <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Skipping non-Projection &quot;</span><span class="o">+</span><span class="n">conn</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_projection_view</span><span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
<span class="c">######################################################################</span>
<span class="c">## CEBALERT: when a TemplatePlot tp is created from a ProjectionView</span>
<span class="c">## pv, tp.plot_src_name comes ultimately from pv.projection.src.name,</span>
<span class="c">## but tp.plot_bounding_box comes from pv.projection.dest.bounds. So,</span>
<span class="c">## we get a plot with mismatched src_name and bounds. Fixing that here</span>
<span class="c">## is not the correct solution, but it allows the Projection Activity</span>
<span class="c">## GUI window to work.</span>
                    <span class="n">v</span><span class="o">.</span><span class="n">src_name</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">name</span>
<span class="c">## JABALERT: Similarly, probably not the right thing to do, but makes</span>
<span class="c">## the name of the src available for the plot to be labelled.</span>
                    <span class="n">v</span><span class="o">.</span><span class="n">proj_src_name</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">name</span>
<span class="c">######################################################################</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;ProjectionActivity&#39;</span><span class="p">,</span><span class="n">v</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">v</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">v</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">sheet_views</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

</div>
<span class="n">pg</span> <span class="o">=</span>  <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Projection Activity&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Basic&quot;</span><span class="p">,</span>
             <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Plot the activity in each Projection that connects to a Sheet.&#39;</span><span class="p">,</span>
             <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">update_projectionactivity</span><span class="o">.</span><span class="n">instance</span><span class="p">()],</span>
             <span class="n">plot_immediately</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s">&#39;Individually&#39;</span><span class="p">,</span><span class="n">auto_refresh</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Projection Activity&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;ProjectionActivity&#39;</span><span class="p">)])</span>


<div class="viewcode-block" id="measure_rfs"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.measure_rfs">[docs]</a><span class="k">class</span> <span class="nc">measure_rfs</span><span class="p">(</span><span class="n">SingleInputResponseCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Map receptive fields by reverse correlation.</span>

<span class="sd">    Presents a large collection of input patterns, typically pixel by pixel on</span>
<span class="sd">    and off, keeping track of which units in the specified input_sheet were</span>
<span class="sd">    active when each unit in other Sheets in the simulation was active.  This</span>
<span class="sd">    data can then be used to plot receptive fields for each unit.  Note that</span>
<span class="sd">    the results are true receptive fields, not the connection fields usually</span>
<span class="sd">    presented in lieu of receptive fields, because they take all circuitry in</span>
<span class="sd">    between the input and the target unit into account.</span>

<span class="sd">    Note also that it is crucial to set the scale parameter properly when using</span>
<span class="sd">    units with a hard activation threshold (as opposed to a smooth sigmoid),</span>
<span class="sd">    because the input pattern used here may not be a very effective way to</span>
<span class="sd">    drive the unit to activate.  The value should be set high enough that the</span>
<span class="sd">    target units activate at least some of the time there is a pattern on the</span>
<span class="sd">    input.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">static_parameters</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;offset&quot;</span><span class="p">,</span><span class="s">&quot;size&quot;</span><span class="p">])</span>

    <span class="n">sampling_interval</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    	The sampling interval determines the number of units in the input sheet</span>
<span class="s">    	that are sampled per presentation.  The higher the value the coarser</span>
<span class="s">    	the receptive field measurement will be.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">sampling_area</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">NumericTuple</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    	Dimensions of the area to be sampled during reverse correlation</span>
<span class="s">        measured in units x and y on the input sheet centered around the origin</span>
<span class="s">        and expressed as a tuple (x,y).&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">__abstract</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">ParamOverrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">(</span><span class="s">&#39;input_sheet&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compute_default</span><span class="p">()</span>
        <span class="n">x</span><span class="o">=</span><span class="n">ReverseCorrelation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_feature_list</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">input_sheet</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">input_sheet</span><span class="p">)</span>
        <span class="n">static_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">s</span><span class="p">,</span><span class="n">p</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">static_parameters</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">pattern_presenter</span><span class="o">.</span><span class="n">duration</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">duration</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">apply_output_fns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">pattern_presenter</span><span class="o">.</span><span class="n">apply_output_fns</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">apply_output_fns</span>
        <span class="n">x</span><span class="o">.</span><span class="n">collect_feature_responses</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">pattern_presenter</span><span class="p">,</span><span class="n">static_params</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">display</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_feature_list</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">input_sheet</span><span class="o">.</span><span class="n">nominal_bounds</span><span class="o">.</span><span class="n">lbrt</span><span class="p">()</span>
        <span class="n">sheet_density</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">input_sheet</span><span class="o">.</span><span class="n">nominal_density</span><span class="p">)</span>
        <span class="n">x_units</span><span class="p">,</span><span class="n">y_units</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">input_sheet</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">unit_size</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">sheet_density</span>
        <span class="n">p</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">unit_size</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">sampling_interval</span>

        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">sampling_area</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">p</span><span class="o">.</span><span class="n">sampling_area</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_units</span><span class="p">,</span><span class="n">y_units</span><span class="p">)</span>

        <span class="n">y_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">top</span> <span class="o">-</span> <span class="p">(</span><span class="n">unit_size</span> <span class="o">*</span> <span class="n">floor</span><span class="p">((</span><span class="n">y_units</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">sampling_area</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">)),</span> <span class="n">bottom</span> <span class="o">+</span> <span class="p">(</span><span class="n">unit_size</span> <span class="o">*</span> <span class="n">ceil</span><span class="p">((</span><span class="n">y_units</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">sampling_area</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">x_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">right</span> <span class="o">-</span> <span class="p">(</span><span class="n">unit_size</span> <span class="o">*</span> <span class="n">floor</span><span class="p">((</span><span class="n">x_units</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">sampling_area</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">)),</span> <span class="n">left</span> <span class="o">+</span> <span class="p">(</span><span class="n">unit_size</span> <span class="o">*</span> <span class="n">ceil</span><span class="p">((</span><span class="n">x_units</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">sampling_area</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">x_range</span><span class="p">,</span> <span class="n">step</span><span class="o">=-</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">y_range</span><span class="p">,</span> <span class="n">step</span><span class="o">=-</span><span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;scale&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">scale</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">scale</span><span class="o">*</span><span class="mi">2</span><span class="p">)]</span>
</div>
<span class="n">pg</span> <span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;RF Projection&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&#39;Other&#39;</span><span class="p">,</span>
    <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure receptive fields.&#39;</span><span class="p">,</span>
    <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_rfs</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">pattern_presenter</span><span class="o">=</span><span class="n">PatternPresenter</span><span class="p">(</span><span class="n">RawRectangle</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">aspect_ratio</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)))],</span>
    <span class="n">normalize</span><span class="o">=</span><span class="s">&#39;Individually&#39;</span><span class="p">)</span>

<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;RFs&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;RFs&#39;</span><span class="p">)])</span>


<span class="c"># Helper function for measuring direction maps</span>
<div class="viewcode-block" id="compute_orientation_from_direction"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.compute_orientation_from_direction">[docs]</a><span class="k">def</span> <span class="nf">compute_orientation_from_direction</span><span class="p">(</span><span class="n">current_values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the orientation corresponding to the given direction.</span>

<span class="sd">    Wraps the value to be in the range [0,pi), and rounds it slightly</span>
<span class="sd">    so that wrapped values are precisely the same (to avoid biases</span>
<span class="sd">    caused by vector averaging with keep_peak=True).</span>

<span class="sd">    Note that in very rare cases (1 in 10^-13?), rounding could lead</span>
<span class="sd">    to different values for a wrapped quantity, and thus give a</span>
<span class="sd">    heavily biased orientation map.  In that case, just choose a</span>
<span class="sd">    different number of directions to test, to avoid that floating</span>
<span class="sd">    point boundary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(((</span><span class="nb">dict</span><span class="p">(</span><span class="n">current_values</span><span class="p">)[</span><span class="s">&#39;direction&#39;</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="o">%</span> <span class="n">pi</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="measure_sine_pref"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.measure_sine_pref">[docs]</a><span class="k">class</span> <span class="nc">measure_sine_pref</span><span class="p">(</span><span class="n">SinusoidalMeasureResponseCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Measure preferences for sine gratings in various combinations.</span>
<span class="sd">    Can measure orientation, spatial frequency, spatial phase,</span>
<span class="sd">    ocular dominance, horizontal phase disparity, color hue, motion</span>
<span class="sd">    direction, and speed of motion.</span>

<span class="sd">    In practice, this command is useful for any subset of the possible</span>
<span class="sd">    combinations, but if all combinations are included, the number of</span>
<span class="sd">    input patterns quickly grows quite large, much larger than the</span>
<span class="sd">    typical number of patterns required for an entire simulation.</span>
<span class="sd">    Thus typically this command will be used for the subset of</span>
<span class="sd">    dimensions that need to be evaluated together, while simpler</span>
<span class="sd">    special-purpose routines are provided below for other dimensions</span>
<span class="sd">    (such as hue and disparity).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">num_ocularity</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Number of ocularity values to test; set to 1 to disable or 2 to enable.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">num_disparity</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">48</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Number of disparity values to test; set to 1 to disable or e.g. 12 to enable.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">num_hue</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">48</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Number of hues to test; set to 1 to disable or e.g. 8 to enable.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">num_direction</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">48</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Number of directions to test.  If nonzero, overrides num_orientation,</span>
<span class="s">        because the orientation is calculated to be perpendicular to the direction.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">num_speeds</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Number of speeds to test (where zero means only static patterns).</span>
<span class="s">        Ignored when num_direction=0.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">max_speed</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">24.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        The maximum speed to measure (with zero always the minimum).&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">subplot</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">&quot;Orientation&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="c"># Always varies frequency and phase; everything else depends on parameters.</span>

        <span class="n">features</span> <span class="o">=</span> \
            <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;frequency&quot;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span>
                    <span class="n">preference_fn</span><span class="o">=</span><span class="n">DSF_WeightedAverage</span><span class="p">())]</span>

        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">num_direction</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">features</span> <span class="o">+=</span> \
            <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;orientation&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_orientation</span><span class="p">,</span>
                            <span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">preference_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preference_fn</span><span class="p">)]</span>

        <span class="n">features</span> <span class="o">+=</span> \
            <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;phase&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_phase</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="n">preference_fn</span><span class="o">=</span><span class="n">DSF_WeightedAverage</span><span class="p">(</span> <span class="n">value_scale</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mf">2.0</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span> <span class="p">))]</span>

        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">num_ocularity</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">features</span> <span class="o">+=</span> \
            <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;ocular&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_ocularity</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">num_disparity</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">features</span> <span class="o">+=</span> \
            <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;phasedisparity&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_disparity</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">num_hue</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">features</span> <span class="o">+=</span> \
            <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;hue&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_hue</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">num_direction</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">num_speeds</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">features</span> <span class="o">+=</span> \
            <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;speed&quot;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">False</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">num_direction</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">num_speeds</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="n">features</span> <span class="o">+=</span> \
            <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;speed&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_speeds</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">False</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">num_direction</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="c"># Compute orientation from direction</span>
            <span class="n">dr</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;direction&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_direction</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">or_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">compute_orientation_from_direction</span><span class="p">([(</span><span class="s">&quot;direction&quot;</span><span class="p">,</span><span class="n">v</span><span class="p">)])</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dr</span><span class="o">.</span><span class="n">values</span><span class="p">]))</span>
            <span class="n">features</span> <span class="o">+=</span> <span class="p">[</span><span class="n">dr</span><span class="p">,</span> \
                 <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;orientation&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">pi</span><span class="p">),</span><span class="n">values</span><span class="o">=</span><span class="n">or_values</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                         <span class="n">compute_fn</span><span class="o">=</span><span class="n">compute_orientation_from_direction</span><span class="p">,</span><span class="n">preference_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preference_fn</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">features</span>


<span class="c"># Here as the simplest possible example; could be moved elsewhere.</span></div>
<div class="viewcode-block" id="measure_or_pref"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.measure_or_pref">[docs]</a><span class="k">class</span> <span class="nc">measure_or_pref</span><span class="p">(</span><span class="n">SinusoidalMeasureResponseCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Measure an orientation preference map by collating the response to patterns.&quot;&quot;&quot;</span>

    <span class="n">subplot</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">&quot;Orientation&quot;</span><span class="p">)</span>

    <span class="n">preference_fn</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ClassSelector</span><span class="p">(</span> <span class="n">DistributionStatisticFn</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">DSF_WeightedAverage</span><span class="p">(</span><span class="n">value_scale</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="o">/</span><span class="n">pi</span><span class="p">)),</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Function that will be used to analyze the distributions of unit</span>
<span class="s">        responses. Sets value_scale to normalize orientation preference</span>
<span class="s">        values.&quot;&quot;&quot;</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;frequency&quot;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">frequencies</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;orientation&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_orientation</span><span class="p">,</span>
                        <span class="n">preference_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preference_fn</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;phase&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_phase</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">)]</span>

</div>
<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Orientation Preference&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Preference Maps&quot;</span><span class="p">,</span>
             <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure preference for sine grating orientation.&#39;</span><span class="p">,</span>
             <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_sine_pref</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span>
                 <span class="n">preference_fn</span><span class="o">=</span><span class="n">DSF_WeightedAverage</span><span class="p">(</span> <span class="n">value_scale</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span> <span class="p">))]</span> <span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Orientation Preference&#39;</span><span class="p">,[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;OrientationPreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Orientation Preference&amp;Selectivity&#39;</span><span class="p">,</span>
            <span class="p">[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;OrientationPreference&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Confidence&#39;</span><span class="p">,</span><span class="s">&#39;OrientationSelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Orientation Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;OrientationSelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Phase Preference&#39;</span><span class="p">,[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;PhasePreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Phase Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;PhaseSelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_static_image</span><span class="p">(</span><span class="s">&#39;Color Key&#39;</span><span class="p">,</span><span class="s">&#39;command/or_key_white_vert_small.png&#39;</span><span class="p">)</span>


<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;vonMises Orientation Preference&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Preference Maps&quot;</span><span class="p">,</span>
             <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure preference for sine grating orientation using von Mises fit.&#39;</span><span class="p">,</span>
             <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_sine_pref</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span>
                 <span class="n">preference_fn</span><span class="o">=</span><span class="n">DSF_VonMisesFit</span><span class="p">(</span> <span class="n">value_scale</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span> <span class="p">),</span>
                 <span class="n">num_orientation</span><span class="o">=</span><span class="mi">16</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Orientation Preference&#39;</span><span class="p">,[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;OrientationPreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Orientation Preference&amp;Selectivity&#39;</span><span class="p">,</span>
            <span class="p">[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;OrientationPreference&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Confidence&#39;</span><span class="p">,</span><span class="s">&#39;OrientationSelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Orientation Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;OrientationSelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Phase Preference&#39;</span><span class="p">,[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;PhasePreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Phase Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;PhaseSelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_static_image</span><span class="p">(</span><span class="s">&#39;Color Key&#39;</span><span class="p">,</span><span class="s">&#39;command/or_key_white_vert_small.png&#39;</span><span class="p">)</span>


<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Bimodal Orientation Preference&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s">&quot;Preference Maps&quot;</span><span class="p">,</span>
             <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure preference for sine grating orientation using bimodal von Mises fit.&#39;</span><span class="p">,</span>
             <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_sine_pref</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span>
                 <span class="n">preference_fn</span><span class="o">=</span><span class="n">DSF_BimodalVonMisesFit</span><span class="p">(</span> <span class="n">value_scale</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span> <span class="p">),</span>
                 <span class="n">num_orientation</span><span class="o">=</span><span class="mi">16</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Orientation Preference&#39;</span><span class="p">,[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;OrientationPreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Orientation Preference&amp;Selectivity&#39;</span><span class="p">,</span>
            <span class="p">[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;OrientationPreference&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Confidence&#39;</span><span class="p">,</span><span class="s">&#39;OrientationSelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Orientation Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;OrientationSelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Second Orientation Preference&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;OrientationMode2Preference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Second Orientation Preference&amp;Selectivity&#39;</span><span class="p">,</span>
            <span class="p">[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;OrientationMode2Preference&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Confidence&#39;</span><span class="p">,</span><span class="s">&#39;OrientationMode2Selectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Second Orientation Selectivity&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;OrientationMode2Selectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_static_image</span><span class="p">(</span><span class="s">&#39;Color Key&#39;</span><span class="p">,</span> <span class="s">&#39;command/or_key_white_vert_small.png&#39;</span><span class="p">)</span>


<span class="n">pg</span> <span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Two Orientation Preferences&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&#39;Preference Maps&#39;</span><span class="p">,</span>
    <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Display the two most preferred orientations for each units, using bimodal von Mises fit.&#39;</span><span class="p">,</span>
    <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_sine_pref</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span>
         <span class="n">preference_fn</span><span class="o">=</span><span class="n">DSF_BimodalVonMisesFit</span><span class="p">(),</span> <span class="n">num_orientation</span><span class="o">=</span><span class="mi">16</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span> <span class="s">&#39;Two Orientation Preferences&#39;</span><span class="p">,</span> <span class="p">[</span>
		<span class="p">(</span> <span class="s">&#39;Or1&#39;</span><span class="p">,</span>	<span class="s">&#39;OrientationPreference&#39;</span> <span class="p">),</span>
		<span class="p">(</span> <span class="s">&#39;Sel1&#39;</span><span class="p">,</span>	<span class="s">&#39;OrientationSelectivity&#39;</span> <span class="p">),</span>
		<span class="p">(</span> <span class="s">&#39;Or2&#39;</span><span class="p">,</span>	<span class="s">&#39;OrientationMode2Preference&#39;</span> <span class="p">),</span>
		<span class="p">(</span> <span class="s">&#39;Sel2&#39;</span><span class="p">,</span>	<span class="s">&#39;OrientationMode2Selectivity&#39;</span> <span class="p">)</span>
<span class="p">])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_static_image</span><span class="p">(</span><span class="s">&#39;Color Key&#39;</span><span class="p">,</span><span class="s">&#39;command/two_or_key_vert.png&#39;</span><span class="p">)</span>


<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Spatial Frequency Preference&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Preference Maps&quot;</span><span class="p">,</span>
             <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure preference for sine grating orientation and frequency.&#39;</span><span class="p">,</span>
             <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_sine_pref</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span>
                 <span class="n">preference_fn</span><span class="o">=</span><span class="n">DSF_WeightedAverage</span><span class="p">(</span> <span class="n">value_scale</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span> <span class="p">))]</span> <span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Spatial Frequency Preference&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;FrequencyPreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Spatial Frequency Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;FrequencySelectivity&#39;</span><span class="p">)])</span>
<span class="c"># Just calls measure_sine_pref to plot different maps.</span>


<div class="viewcode-block" id="measure_od_pref"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.measure_od_pref">[docs]</a><span class="k">class</span> <span class="nc">measure_od_pref</span><span class="p">(</span><span class="n">SinusoidalMeasureResponseCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Measure an ocular dominance preference map by collating the response to patterns.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;frequency&quot;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">frequencies</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;orientation&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_orientation</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;phase&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_phase</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;ocular&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span><span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])]</span>
</div>
<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Ocular Preference&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Preference Maps&quot;</span><span class="p">,</span>
             <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure preference for sine gratings between two eyes.&#39;</span><span class="p">,</span>
             <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_sine_pref</span><span class="o">.</span><span class="n">instance</span><span class="p">()])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Ocular Preference&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;OcularPreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Ocular Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;OcularSelectivity&#39;</span><span class="p">)])</span>




<div class="viewcode-block" id="measure_phasedisparity"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.measure_phasedisparity">[docs]</a><span class="k">class</span> <span class="nc">measure_phasedisparity</span><span class="p">(</span><span class="n">SinusoidalMeasureResponseCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Measure a phase disparity preference map by collating the response to patterns.&quot;&quot;&quot;</span>

    <span class="n">num_disparity</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">48</span><span class="p">),</span>
                                  <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Number of disparity values to test.&quot;</span><span class="p">)</span>

    <span class="n">orientation</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Orientation of the test pattern; typically vertical to measure</span>
<span class="s">        horizontal disparity.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">static_parameters</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;orientation&quot;</span><span class="p">,</span><span class="s">&quot;scale&quot;</span><span class="p">,</span><span class="s">&quot;offset&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;frequency&quot;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">frequencies</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;phase&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_phase</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;phasedisparity&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_disparity</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">)]</span>

</div>
<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;PhaseDisparity Preference&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Preference Maps&quot;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    Measure preference for sine gratings at a specific orentation differing in phase</span>
<span class="s">    between two input sheets.&quot;&quot;&quot;</span><span class="p">,</span>
             <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_phasedisparity</span><span class="o">.</span><span class="n">instance</span><span class="p">()],</span><span class="n">normalize</span><span class="o">=</span><span class="s">&#39;Individually&#39;</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;PhaseDisparity Preference&#39;</span><span class="p">,[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;PhasedisparityPreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;PhaseDisparity Preference&amp;Selectivity&#39;</span><span class="p">,</span>
            <span class="p">[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;PhasedisparityPreference&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Confidence&#39;</span><span class="p">,</span><span class="s">&#39;PhasedisparitySelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;PhaseDisparity Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;PhasedisparitySelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_static_image</span><span class="p">(</span><span class="s">&#39;Color Key&#39;</span><span class="p">,</span><span class="s">&#39;command/disp_key_white_vert_small.png&#39;</span><span class="p">)</span>



<div class="viewcode-block" id="measure_dr_pref"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.measure_dr_pref">[docs]</a><span class="k">class</span> <span class="nc">measure_dr_pref</span><span class="p">(</span><span class="n">SinusoidalMeasureResponseCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Measure a direction preference map by collating the response to patterns.&quot;&quot;&quot;</span>

    <span class="n">num_phase</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">num_direction</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">48</span><span class="p">),</span>
                                  <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Number of directions to test.&quot;</span><span class="p">)</span>

    <span class="n">num_speeds</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Number of speeds to test (where zero means only static patterns).&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">max_speed</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">24.0</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        The maximum speed to measure (with zero always the minimum).&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">subplot</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">&quot;Direction&quot;</span><span class="p">)</span>

    <span class="n">preference_fn</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ClassSelector</span><span class="p">(</span> <span class="n">DistributionStatisticFn</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">DSF_WeightedAverage</span><span class="p">(</span><span class="n">value_scale</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">))),</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Function that will be used to analyze the distributions of</span>
<span class="s">        unit responses. Sets value_scale to normalize direction</span>
<span class="s">        preference values.&quot;&quot;&quot;</span> <span class="p">)</span>


    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="c"># orientation is computed from direction</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;direction&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_direction</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">or_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">compute_orientation_from_direction</span><span class="p">([(</span><span class="s">&quot;direction&quot;</span><span class="p">,</span><span class="n">v</span><span class="p">)])</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dr</span><span class="o">.</span><span class="n">values</span><span class="p">]))</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;speed&quot;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">num_speeds</span> <span class="ow">is</span> <span class="mi">0</span> <span class="k">else</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;speed&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_speeds</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;frequency&quot;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">frequencies</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;direction&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_direction</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">preference_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preference_fn</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;phase&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_phase</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;orientation&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">pi</span><span class="p">),</span><span class="n">values</span><span class="o">=</span><span class="n">or_values</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">compute_fn</span><span class="o">=</span><span class="n">compute_orientation_from_direction</span><span class="p">)]</span>

</div>
<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Direction Preference&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Preference Maps&quot;</span><span class="p">,</span>
             <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure preference for sine grating movement direction.&#39;</span><span class="p">,</span>
             <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_dr_pref</span><span class="o">.</span><span class="n">instance</span><span class="p">()])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Direction Preference&#39;</span><span class="p">,[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;DirectionPreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Direction Preference&amp;Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;DirectionPreference&#39;</span><span class="p">),</span>
                                                <span class="p">(</span><span class="s">&#39;Confidence&#39;</span><span class="p">,</span><span class="s">&#39;DirectionSelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Direction Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;DirectionSelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Speed Preference&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;SpeedPreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Speed Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;SpeedSelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_static_image</span><span class="p">(</span><span class="s">&#39;Color Key&#39;</span><span class="p">,</span><span class="s">&#39;command/dr_key_white_vert_small.png&#39;</span><span class="p">)</span>



<div class="viewcode-block" id="measure_hue_pref"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.measure_hue_pref">[docs]</a><span class="k">class</span> <span class="nc">measure_hue_pref</span><span class="p">(</span><span class="n">SinusoidalMeasureResponseCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Measure a hue preference map by collating the response to patterns.&quot;&quot;&quot;</span>

    <span class="n">num_phase</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">num_hue</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">48</span><span class="p">),</span>
                            <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Number of hues to test.&quot;</span><span class="p">)</span>

    <span class="n">subplot</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">&quot;Hue&quot;</span><span class="p">)</span>

    <span class="c"># For backwards compatibility; not sure why it needs to differ from the default</span>
    <span class="n">static_parameters</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[])</span>

    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;frequency&quot;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">frequencies</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;orientation&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_orientation</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;hue&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_hue</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;phase&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_phase</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">)]</span>

</div>
<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Hue Preference&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Preference Maps&quot;</span><span class="p">,</span>
             <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure preference for colors.&#39;</span><span class="p">,</span>
             <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_hue_pref</span><span class="o">.</span><span class="n">instance</span><span class="p">()],</span><span class="n">normalize</span><span class="o">=</span><span class="s">&#39;Individually&#39;</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Hue Preference&#39;</span><span class="p">,[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;HuePreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Hue Preference&amp;Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;HuePreference&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Confidence&#39;</span><span class="p">,</span><span class="s">&#39;HueSelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Hue Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;HueSelectivity&#39;</span><span class="p">)])</span>



<span class="n">gaussian_corner</span> <span class="o">=</span> <span class="n">Composite</span><span class="p">(</span>
    <span class="n">operator</span> <span class="o">=</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">generators</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Gaussian</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">0.06</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">aspect_ratio</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="mf">0.3</span><span class="p">),</span>
        <span class="n">Gaussian</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mf">0.06</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">aspect_ratio</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)])</span>


<div class="viewcode-block" id="measure_second_or_pref"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.measure_second_or_pref">[docs]</a><span class="k">class</span> <span class="nc">measure_second_or_pref</span><span class="p">(</span><span class="n">SinusoidalMeasureResponseCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Measure the secondary  orientation preference maps.&quot;&quot;&quot;</span>

    <span class="n">num_orientation</span>	<span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span> <span class="n">default</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">64</span><span class="p">),</span>
                                    <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Number of orientations to test.&quot;</span><span class="p">)</span>
    <span class="n">true_peak</span> 	 	<span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span> <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;If set the second</span>
<span class="s">	    orientation response is computed on the true second mode of the</span>
<span class="s">	    orientation distribution, otherwise is just the second maximum response&quot;&quot;&quot;</span> <span class="p">)</span>

    <span class="n">subplot</span>		<span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">&quot;Second Orientation&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    	<span class="n">fs</span>	<span class="o">=</span> <span class="p">[</span> <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;frequency&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">frequencies</span><span class="p">)</span> <span class="p">]</span>
    	<span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">true_peak</span><span class="p">:</span>
	    <span class="n">fs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
		<span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;orientation&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">pi</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_orientation</span><span class="p">,</span>
                    <span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">preference_fn</span><span class="o">=</span><span class="n">DSF_BimodalPeaks</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
	    <span class="n">fs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
		<span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;orientation&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">pi</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_orientation</span><span class="p">,</span>
                    <span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">preference_fn</span><span class="o">=</span><span class="n">DSF_BimodalPeaks</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span>
	<span class="n">fs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;phase&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_phase</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="p">)</span>

	<span class="k">return</span> <span class="n">fs</span>

</div>
<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Second Orientation Preference&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s">&quot;Preference Maps&quot;</span><span class="p">,</span>
             <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure the second preference for sine grating orientation.&#39;</span><span class="p">,</span>
             <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_second_or_pref</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span> <span class="n">true_peak</span><span class="o">=</span><span class="bp">False</span> <span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Second Orientation Preference&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;OrientationMode2Preference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Second Orientation Preference&amp;Selectivity&#39;</span><span class="p">,</span>
            <span class="p">[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;OrientationMode2Preference&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Confidence&#39;</span><span class="p">,</span><span class="s">&#39;OrientationMode2Selectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Second Orientation Selectivity&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;OrientationMode2Selectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_static_image</span><span class="p">(</span><span class="s">&#39;Color Key&#39;</span><span class="p">,</span> <span class="s">&#39;command/or_key_white_vert_small.png&#39;</span><span class="p">)</span>


<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Second Peak Orientation Preference&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Preference Maps&quot;</span><span class="p">,</span>
             <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure the second peak preference for sine grating orientation.&#39;</span><span class="p">,</span>
             <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_second_or_pref</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span> <span class="n">true_peak</span><span class="o">=</span><span class="bp">True</span> <span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Second Peak Orientation Preference&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;OrientationMode2Preference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Second Peak Orientation Preference&amp;Selectivity&#39;</span><span class="p">,</span>
            <span class="p">[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;OrientationMode2Preference&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;Confidence&#39;</span><span class="p">,</span><span class="s">&#39;OrientationMode2Selectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Second Peak Orientation Selectivity&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;OrientationMode2Selectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_static_image</span><span class="p">(</span><span class="s">&#39;Color Key&#39;</span><span class="p">,</span><span class="s">&#39;command/or_key_white_vert_small.png&#39;</span><span class="p">)</span>


<span class="n">pg</span> <span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Two Peaks Orientation Preferences&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&#39;Preference Maps&#39;</span><span class="p">,</span>
    <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Display the two most preferred orientations for all units with a</span>
<span class="s">    multimodal orientation preference distribution.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span>
    		<span class="n">measure_second_or_pref</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span><span class="n">num_orientation</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">true_peak</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span> <span class="s">&#39;Two Peaks Orientation Preferences&#39;</span><span class="p">,</span> <span class="p">[</span>
		<span class="p">(</span> <span class="s">&#39;Or1&#39;</span><span class="p">,</span>	<span class="s">&#39;OrientationPreference&#39;</span> <span class="p">),</span>
		<span class="p">(</span> <span class="s">&#39;Sel1&#39;</span><span class="p">,</span>	<span class="s">&#39;OrientationSelectivity&#39;</span> <span class="p">),</span>
		<span class="p">(</span> <span class="s">&#39;Or2&#39;</span><span class="p">,</span>	<span class="s">&#39;OrientationMode2Preference&#39;</span> <span class="p">),</span>
		<span class="p">(</span> <span class="s">&#39;Sel2&#39;</span><span class="p">,</span>	<span class="s">&#39;OrientationMode2Selectivity&#39;</span> <span class="p">)</span>
<span class="p">])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_static_image</span><span class="p">(</span><span class="s">&#39;Color Key&#39;</span><span class="p">,</span><span class="s">&#39;command/two_or_key_vert.png&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="measure_corner_or_pref"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.measure_corner_or_pref">[docs]</a><span class="k">class</span> <span class="nc">measure_corner_or_pref</span><span class="p">(</span><span class="n">PositionMeasurementCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Measure a corner preference map by collating the response to patterns.&quot;&quot;&quot;</span>

    <span class="n">scale</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="n">divisions</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">pattern_presenter</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Callable</span><span class="p">(</span><span class="n">PatternPresenter</span><span class="p">(</span><span class="n">gaussian_corner</span><span class="p">,</span><span class="n">apply_output_fns</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">duration</span><span class="o">=</span><span class="mf">1.0</span><span class="p">))</span>

    <span class="n">x_range</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">NumericTuple</span><span class="p">((</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">1.2</span><span class="p">))</span>

    <span class="n">y_range</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">NumericTuple</span><span class="p">((</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">1.2</span><span class="p">))</span>

    <span class="n">num_orientation</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">24</span><span class="p">),</span>
                                    <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Number of orientations to test.&quot;</span><span class="p">)</span>

    <span class="c"># JABALERT: Presumably this should be omitted, so that size is included?</span>
    <span class="n">static_parameters</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;scale&quot;</span><span class="p">,</span><span class="s">&quot;offset&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="n">width</span> <span class="o">=</span><span class="mf">1.0</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">height</span><span class="o">=</span><span class="mf">1.0</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">y_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">y_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">x_range</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="n">width</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">divisions</span><span class="p">,</span><span class="n">preference_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preference_fn</span><span class="p">),</span>
            <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">y_range</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="n">height</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">divisions</span><span class="p">,</span><span class="n">preference_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preference_fn</span><span class="p">),</span>
            <span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;orientation&quot;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">num_orientation</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                <span class="n">preference_fn</span><span class="o">=</span><span class="n">DSF_WeightedAverage</span><span class="p">(</span><span class="n">value_scale</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mf">2.0</span><span class="o">/</span><span class="n">pi</span><span class="p">))</span>
            <span class="p">)]</span>

</div>
<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Corner OR Preference&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Preference Maps&quot;</span><span class="p">,</span>
             <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure orientation preference for corner shape (or other complex stimuli that cannot be represented as fullfield patterns).&#39;</span><span class="p">,</span>
             <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_corner_or_pref</span><span class="o">.</span><span class="n">instance</span><span class="p">(</span>
                 <span class="n">preference_fn</span><span class="o">=</span><span class="n">DSF_WeightedAverage</span><span class="p">())],</span>
             <span class="n">normalize</span><span class="o">=</span><span class="s">&#39;Individually&#39;</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Corner Orientation Preference&#39;</span><span class="p">,[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;OrientationPreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Corner Orientation Preference&amp;Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;OrientationPreference&#39;</span><span class="p">),</span>
                                                   <span class="p">(</span><span class="s">&#39;Confidence&#39;</span><span class="p">,</span><span class="s">&#39;OrientationSelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Corner Orientation Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;OrientationSelectivity&#39;</span><span class="p">)])</span>


<div class="viewcode-block" id="measure_corner_angle_pref"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.measure_corner_angle_pref">[docs]</a><span class="k">class</span> <span class="nc">measure_corner_angle_pref</span><span class="p">(</span><span class="n">PositionMeasurementCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate the preference map for angle shapes, by collating the response to patterns.&quot;&quot;&quot;</span>

    <span class="n">scale</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="n">positions</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">x_range</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">NumericTuple</span><span class="p">((</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>

    <span class="n">y_range</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">NumericTuple</span><span class="p">((</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>

    <span class="n">num_or</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">24</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span>
        <span class="s">&quot;Number of orientations to test.&quot;</span><span class="p">)</span>

    <span class="n">angle_0</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.25</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">pi</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span>
        <span class="s">&quot;First angle to test.&quot;</span><span class="p">)</span>

    <span class="n">angle_1</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.75</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">pi</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span><span class="n">pi</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span>
        <span class="s">&quot;Last angle to test.&quot;</span><span class="p">)</span>

    <span class="n">num_angle</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span>
        <span class="s">&quot;Number of angles to test.&quot;</span><span class="p">)</span>

    <span class="n">key_img_fname</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">Filename</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;command/key_angles.png&#39;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span>
        <span class="s">&quot;Name of the file with the image used to code angles with hues.&quot;</span><span class="p">)</span>

    <span class="n">pattern_presenter</span><span class="o">=</span><span class="n">PatternPresenter</span><span class="p">(</span><span class="n">GaussiansCorner</span><span class="p">(</span><span class="n">aspect_ratio</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span><span class="n">cross</span><span class="o">=</span><span class="mf">0.85</span><span class="p">),</span><span class="n">apply_output_fns</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">duration</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="n">static_parameters</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span> <span class="n">default</span><span class="o">=</span><span class="p">[</span> <span class="s">&quot;size&quot;</span><span class="p">,</span> <span class="s">&quot;scale&quot;</span><span class="p">,</span> <span class="s">&quot;offset&quot;</span> <span class="p">]</span> <span class="p">)</span>



    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">p</span> <span class="p">):</span>
    	<span class="sd">&quot;&quot;&quot;Return the list of features to vary, generate hue code static image&quot;&quot;&quot;</span>
        <span class="n">x_step</span>	<span class="o">=</span> <span class="p">(</span> <span class="n">p</span><span class="o">.</span><span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span> <span class="n">p</span><span class="o">.</span><span class="n">positions</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="n">y_step</span>	<span class="o">=</span> <span class="p">(</span> <span class="n">p</span><span class="o">.</span><span class="n">y_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">y_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span> <span class="n">p</span><span class="o">.</span><span class="n">positions</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span>
	<span class="n">o_step</span>	<span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">pi</span> <span class="o">/</span> <span class="n">p</span><span class="o">.</span><span class="n">num_or</span>
	<span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">angle_0</span> <span class="o">&lt;</span> <span class="n">p</span><span class="o">.</span><span class="n">angle_1</span><span class="p">:</span>
            <span class="n">angle_0</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">angle_0</span>
            <span class="n">angle_1</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">angle_1</span>
	<span class="k">else</span><span class="p">:</span>
            <span class="n">angle_0</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">angle_1</span>
            <span class="n">angle_1</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">angle_0</span>
	<span class="n">a_range</span>	<span class="o">=</span> <span class="p">(</span> <span class="n">angle_0</span><span class="p">,</span> <span class="n">angle_1</span> <span class="p">)</span>
	<span class="n">a_step</span>	<span class="o">=</span> <span class="p">(</span> <span class="n">angle_1</span> <span class="o">-</span> <span class="n">angle_0</span> <span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span> <span class="n">p</span><span class="o">.</span><span class="n">num_angle</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_make_key_image</span><span class="p">(</span> <span class="n">p</span> <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">Feature</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span>           <span class="nb">range</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">x_range</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">x_step</span> <span class="p">),</span>
            <span class="n">Feature</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">,</span>           <span class="nb">range</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">y_range</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">y_step</span> <span class="p">),</span>
            <span class="n">Feature</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;orientation&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="n">o_step</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="bp">True</span> <span class="p">),</span>
            <span class="n">Feature</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;angle&quot;</span><span class="p">,</span>       <span class="nb">range</span><span class="o">=</span><span class="n">a_range</span><span class="p">,</span>   <span class="n">step</span><span class="o">=</span><span class="n">a_step</span><span class="p">,</span>
                    <span class="n">preference_fn</span><span class="o">=</span><span class="n">DSF_WeightedAverage</span><span class="p">(</span> <span class="n">value_scale</span><span class="o">=</span><span class="p">(</span> <span class="o">-</span><span class="n">angle_0</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">angle_1</span><span class="o">-</span><span class="n">angle_0</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
	<span class="p">]</span>


    <span class="k">def</span> <span class="nf">_make_key_image</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">p</span> <span class="p">):</span>
    	<span class="sd">&quot;&quot;&quot;Generate the image with keys to hues used to code angles</span>
<span class="sd">	   the image is saved on-the-fly, in order to fit the current</span>
<span class="sd">	   choice of angle range</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">width</span>	<span class="o">=</span> <span class="mi">60</span>
	<span class="n">height</span>	<span class="o">=</span> <span class="mi">300</span>
	<span class="n">border</span>	<span class="o">=</span> <span class="mi">6</span>
	<span class="n">n_a</span>	<span class="o">=</span> <span class="mi">7</span>
	<span class="n">angle_0</span>	<span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">angle_0</span>
	<span class="n">angle_1</span>	<span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">angle_1</span>
	<span class="n">a_step</span>	<span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span> <span class="n">angle_1</span> <span class="o">-</span> <span class="n">angle_0</span> <span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span> <span class="n">n_a</span> <span class="p">)</span>
	<span class="n">x_0</span>	<span class="o">=</span> <span class="n">border</span>
	<span class="n">x_1</span>	<span class="o">=</span> <span class="p">(</span> <span class="n">width</span> <span class="o">-</span> <span class="n">border</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
	<span class="n">x_a</span>	<span class="o">=</span> <span class="n">x_1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">border</span>
	<span class="n">y_use</span>	<span class="o">=</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">border</span>
	<span class="n">y_step</span>	<span class="o">=</span> <span class="n">y_use</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span> <span class="n">n_a</span> <span class="p">)</span>
	<span class="n">y_d</span>	<span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="nb">float</span><span class="p">(</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">y_step</span> <span class="p">)</span> <span class="p">)</span>
	<span class="n">y_0</span>	<span class="o">=</span> <span class="n">border</span> <span class="o">+</span> <span class="n">y_d</span>
	<span class="n">l</span>	<span class="o">=</span> <span class="mi">15</span>

	<span class="n">hues</span>	<span class="o">=</span> <span class="p">[</span> <span class="s">&quot;hsl(</span><span class="si">%2d</span><span class="s">,100</span><span class="si">%%</span><span class="s">,50</span><span class="si">%%</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">h</span>		<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">360</span> <span class="o">/</span> <span class="n">n_a</span> <span class="p">)</span> <span class="p">]</span>
	<span class="n">angles</span>	<span class="o">=</span> <span class="p">[</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">angle_0</span> <span class="o">+</span> <span class="n">a_step</span> <span class="o">*</span> <span class="n">a</span>		<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">n_a</span> <span class="p">)</span> <span class="p">]</span>
	<span class="n">y_pos</span>	<span class="o">=</span> <span class="p">[</span> <span class="nb">int</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="n">y_0</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y_step</span> <span class="p">)</span> <span class="p">)</span>	<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">n_a</span> <span class="p">)</span> <span class="p">]</span>
	<span class="n">deltas</span>	<span class="o">=</span> <span class="p">[</span> <span class="p">(</span> <span class="nb">int</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="n">l</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span> <span class="n">a</span> <span class="p">)</span> <span class="p">)</span> <span class="p">),</span> <span class="nb">int</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span> <span class="n">l</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span> <span class="n">a</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
							<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">angles</span> <span class="p">]</span>
	<span class="n">lb_img</span>	<span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span> <span class="s">&quot;RGB&quot;</span><span class="p">,</span> <span class="p">(</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="p">),</span> <span class="s">&quot;white&quot;</span> <span class="p">)</span>
	<span class="n">dr_img</span>	<span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span> <span class="n">lb_img</span> <span class="p">)</span>

	<span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">d</span>	<span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span> <span class="n">hues</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="n">deltas</span> <span class="p">):</span>
		<span class="n">dr_img</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span> <span class="p">[</span> <span class="p">(</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_d</span> <span class="p">),</span> <span class="p">(</span> <span class="n">x_1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">y_d</span> <span class="p">)</span> <span class="p">],</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">h</span> <span class="p">)</span>
		<span class="n">dr_img</span><span class="o">.</span><span class="n">line</span><span class="p">(</span> <span class="p">[</span> <span class="p">(</span> <span class="n">x_a</span><span class="p">,</span> <span class="n">y</span> <span class="p">),</span> <span class="p">(</span> <span class="n">x_a</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span> <span class="mi">0</span> <span class="p">],</span> <span class="n">y</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span> <span class="p">],</span> <span class="n">fill</span> <span class="o">=</span> <span class="s">&quot;black&quot;</span> <span class="p">)</span>
		<span class="n">dr_img</span><span class="o">.</span><span class="n">line</span><span class="p">(</span> <span class="p">[</span> <span class="p">(</span> <span class="n">x_a</span><span class="p">,</span> <span class="n">y</span> <span class="p">),</span> <span class="p">(</span> <span class="n">x_a</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span> <span class="mi">0</span> <span class="p">],</span> <span class="n">y</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">)</span> <span class="p">],</span> <span class="n">fill</span> <span class="o">=</span> <span class="s">&quot;black&quot;</span> <span class="p">)</span>
	
	<span class="n">lb_img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span> <span class="n">p</span><span class="o">.</span><span class="n">key_img_fname</span> <span class="p">)</span>

	<span class="c">#return( p.key_img_fname.default )</span>
		
</div>
<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Corner Angle Preference&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;Preference Maps&quot;</span><span class="p">,</span>
             <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure preference for angles in corner shapes&#39;</span><span class="p">,</span>
             <span class="n">normalize</span><span class="o">=</span><span class="s">&#39;Individually&#39;</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span> <span class="n">measure_corner_angle_pref</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span> <span class="p">]</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Corner Angle Preference&#39;</span><span class="p">,[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;AnglePreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Corner Angle Preference&amp;Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;AnglePreference&#39;</span><span class="p">),</span>
                                                   <span class="p">(</span><span class="s">&#39;Confidence&#39;</span><span class="p">,</span><span class="s">&#39;AngleSelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Corner Angle Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;AngleSelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Corner Orientation Preference&#39;</span><span class="p">,[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;OrientationPreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Corner Orientation Preference&amp;Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Hue&#39;</span><span class="p">,</span><span class="s">&#39;OrientationPreference&#39;</span><span class="p">),</span>
                                                   <span class="p">(</span><span class="s">&#39;Confidence&#39;</span><span class="p">,</span><span class="s">&#39;OrientationSelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;Corner Orientation Selectivity&#39;</span><span class="p">,[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;OrientationSelectivity&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_static_image</span><span class="p">(</span> <span class="s">&#39;Hue Code&#39;</span><span class="p">,</span> <span class="n">measure_corner_angle_pref</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">key_img_fname</span> <span class="p">)</span>



<span class="k">class</span> <span class="nc">PatternPresenter2</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">Parameterized</span><span class="p">):</span>

    <span class="n">apply_output_fns</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;When presenting a pattern, whether to apply each</span>
<span class="s">        sheet&#39;s output function.  If False, for many networks the</span>
<span class="s">        response will be linear, which requires fewer test patterns to</span>
<span class="s">        measure a meaningful response, but it may not correspond to the</span>
<span class="s">        actual preferences of each neuron under other conditions. If</span>
<span class="s">        True, callers will need to ensure that the input patterns are</span>
<span class="s">        in a suitable range to drive the neurons to generate meaningful</span>
<span class="s">        output, because e.g. a threshold-based output function might</span>
<span class="s">        result in no activity for inputs that are too weak..&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">duration</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Amount of simulation time for which to present each</span>
<span class="s">        test pattern. By convention, most Topographica example files</span>
<span class="s">        are</span>
<span class="s">        designed to have a suitable activity pattern computed by the</span>
<span class="s">        default time, but the duration will need to be changed for</span>
<span class="s">        other models that do not follow that convention or if a</span>
<span class="s">        linear response is desired.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c"># CEBALERT: generator_sheets=[] is probably a surprising way of</span>
    <span class="c"># actually getting all the generator sheets.</span>
    <span class="n">generator_sheets</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The set of GeneratorSheets onto which patterns will be</span>
<span class="s">        drawn. By default (i.e. for an empty list), all GeneratorSheets</span>
<span class="s">        in the simulation will be used.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">pattern_generator</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">Constant</span><span class="p">(),</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;The PatternGenerator that will be drawn on the generator</span>
<span class="s">        sheets (the parameters of the pattern_generator are specified</span>
<span class="s">        during calls).&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features_values</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">param_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_generator</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">feature</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">features_values</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_generator</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="n">all_input_sheet_names</span> <span class="o">=</span> <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">GeneratorSheet</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generator_sheets</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">input_sheet_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">sheet</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator_sheets</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">input_sheet_names</span> <span class="o">=</span> <span class="n">all_input_sheet_names</span>

        <span class="c"># Copy the given generator once for every GeneratorSheet</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">input_sheet_names</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_generator</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_custom_presenter</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">input_sheet_names</span><span class="p">)</span>

        <span class="c"># blank patterns for unused generator sheets</span>
        <span class="k">for</span> <span class="n">sheet_name</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">all_input_sheet_names</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">input_sheet_names</span><span class="p">)):</span>
            <span class="n">inputs</span><span class="p">[</span><span class="n">sheet_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">pattern_present</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span> <span class="n">plastic</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">apply_output_fns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">apply_output_fns</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_custom_presenter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">input_sheet_names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This method provides a minimum overload for performing custom actions</span>
<span class="sd">        with a pattern presenter.&quot;&quot;&quot;</span>



<div class="viewcode-block" id="frequency_mapper"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.frequency_mapper">[docs]</a><span class="k">class</span> <span class="nc">frequency_mapper</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Activates a generator sheet at the specified frequency (for all latencies).</span>
<span class="sd">    It does so by translating from a frequency to a y position and presenting a line</span>
<span class="sd">    at that y position (of the specified size).&quot;&quot;&quot;</span>

    <span class="n">__abstract</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Thickness (width) of the frequency band for every presentation.&quot;</span><span class="p">)</span>

    <span class="n">frequency_spacing</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The spacing of the available frequency range, this allows us to define</span>
<span class="s">        (and hence map) a non linear spacing by specifying the frequency value at each</span>
<span class="s">        sheet unit.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">frequency_mapper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_spacing</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_spacing</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">getFrequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sheet_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">lbrt</span><span class="p">()</span>
        <span class="n">y_range</span> <span class="o">=</span> <span class="n">sheet_range</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">sheet_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">index</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">sheet_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">y_range</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_spacing</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_spacing</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">setFrequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_frequency</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_spacing</span> <span class="o">&gt;=</span> <span class="n">new_frequency</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">sheet_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">lbrt</span><span class="p">()</span>
        <span class="n">y_range</span> <span class="o">=</span> <span class="n">sheet_range</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">sheet_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_spacing</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_range</span>

        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span> <span class="o">/</span> <span class="n">ratio</span><span class="p">)</span> <span class="o">+</span> <span class="n">sheet_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>


    <span class="n">frequency</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getFrequency</span><span class="p">,</span> <span class="n">setFrequency</span><span class="p">,</span> <span class="s">&quot;The frequency at which to present.&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="measure_frequency_preference"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.measure_frequency_preference">[docs]</a><span class="k">class</span> <span class="nc">measure_frequency_preference</span><span class="p">(</span><span class="n">MeasureResponseCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Measure a best frequency preference and selectivity map for auditory neurons.&quot;&quot;&quot;</span>

    <span class="n">display</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">static_parameters</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;scale&quot;</span><span class="p">,</span> <span class="s">&quot;offset&quot;</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="n">input_sheets</span> <span class="o">=</span> <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">GeneratorSheet</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

        <span class="c"># BK-NOTE: if anyone wants to generalise this method for heterogeneous sheets, by all means do so,</span>
        <span class="c"># for my personal use the additional code required to generalise was overkill.</span>
        <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_sheets</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">==</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span>
            <span class="k">assert</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="p">]</span><span class="o">.</span><span class="n">xdensity</span> <span class="o">==</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xdensity</span>
            <span class="k">assert</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="p">]</span><span class="o">.</span><span class="n">ydensity</span> <span class="o">==</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ydensity</span>

        <span class="n">divisions</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">input_sheets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ydensity</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">min_frequency</span> <span class="o">=</span> <span class="n">input_sheets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">input_generator</span><span class="o">.</span><span class="n">min_frequency</span>
            <span class="n">max_frequency</span> <span class="o">=</span> <span class="n">input_sheets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">input_generator</span><span class="o">.</span><span class="n">max_frequency</span>
            <span class="n">frequency_spacing</span> <span class="o">=</span> <span class="n">input_sheets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">input_generator</span><span class="o">.</span><span class="n">frequency_spacing</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">min_frequency</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">max_frequency</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">divisions</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">frequency_spacing</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">min_frequency</span><span class="p">,</span> <span class="n">max_frequency</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">divisions</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Input generator is missing min_frequency, max_frequency, or frequency_spacing - will present linearly from&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_frequency</span><span class="p">),</span> <span class="s">&quot;to&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_frequency</span><span class="p">),</span> <span class="s">&quot;instead.&quot;</span><span class="p">)</span>

        <span class="n">generator</span> <span class="o">=</span> <span class="n">frequency_mapper</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">divisions</span><span class="p">,</span> <span class="n">frequency_spacing</span><span class="o">=</span><span class="n">frequency_spacing</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pattern_presenter</span> <span class="o">=</span> <span class="n">PatternPresenter2</span><span class="p">(</span><span class="n">pattern_generator</span><span class="o">=</span><span class="n">generator</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;frequency&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">min_frequency</span><span class="p">,</span><span class="n">max_frequency</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>

</div>
<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Frequency Preference and Selectivity&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s">&quot;Auditory&quot;</span><span class="p">,</span>
    <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_frequency_preference</span><span class="o">.</span><span class="n">instance</span><span class="p">()],</span> <span class="n">normalize</span><span class="o">=</span><span class="s">&#39;Individually&#39;</span><span class="p">,</span>
    <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure a best frequency preference and selectivity map for auditory neurons.&#39;</span><span class="p">)</span>

<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;[Frequency Preference]&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;FrequencyPreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;[Frequency Selectivity]&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;FrequencySelectivity&#39;</span><span class="p">)])</span>



<div class="viewcode-block" id="log_frequency_mapper"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.log_frequency_mapper">[docs]</a><span class="k">class</span> <span class="nc">log_frequency_mapper</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Activates a generator sheet at the specified frequency (for all latencies).</span>
<span class="sd">        It does so by translating from a frequency to a y position and presenting a line</span>
<span class="sd">        at that y position (of the specified size).&quot;&quot;&quot;</span>

    <span class="n">__abstract</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Thickness (width) of the frequency band for every presentation.&quot;</span><span class="p">)</span>

    <span class="n">frequency_spacing</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;The spacing of the available frequency range, this allows us to define</span>
<span class="s">            (and hence map) a non linear spacing by specifying the frequency value at each</span>
<span class="s">            sheet unit.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">log_frequency_mapper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_spacing</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_spacing</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">getFrequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sheet_min</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">lbrt</span><span class="p">())[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">sheet_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_spacing</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_spacing</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">setFrequencyBand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_frequency_band</span><span class="p">):</span>
        <span class="n">sheet_min</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">lbrt</span><span class="p">())[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">sheet_min</span> <span class="o">+</span> <span class="p">(</span><span class="n">new_frequency_band</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_spacing</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>


    <span class="n">frequency</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getFrequency</span><span class="p">,</span> <span class="n">setFrequencyBand</span><span class="p">,</span> <span class="s">&quot;The log frequency band at which to present.&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_y</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="measure_log_frequency_preference"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.measure_log_frequency_preference">[docs]</a><span class="k">class</span> <span class="nc">measure_log_frequency_preference</span><span class="p">(</span><span class="n">MeasureResponseCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Measure a best frequency preference and selectivity map for auditory neurons.&quot;&quot;&quot;</span>

    <span class="n">display</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">static_parameters</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;scale&quot;</span><span class="p">,</span> <span class="s">&quot;offset&quot;</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="n">input_sheets</span> <span class="o">=</span> <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">GeneratorSheet</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

        <span class="c"># BK-NOTE: if anyone wants to generalise this method for heterogeneous sheets, by all means do so,</span>
        <span class="c"># for my personal use the additional code required to generalise was overkill.</span>
        <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_sheets</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">==</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span>
            <span class="k">assert</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="p">]</span><span class="o">.</span><span class="n">xdensity</span> <span class="o">==</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xdensity</span>
            <span class="k">assert</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="p">]</span><span class="o">.</span><span class="n">ydensity</span> <span class="o">==</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ydensity</span>

        <span class="n">divisions</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">input_sheets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ydensity</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">min_frequency</span> <span class="o">=</span> <span class="n">input_sheets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">input_generator</span><span class="o">.</span><span class="n">min_frequency</span>
            <span class="n">max_frequency</span> <span class="o">=</span> <span class="n">input_sheets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">input_generator</span><span class="o">.</span><span class="n">max_frequency</span>
            <span class="n">frequency_spacing</span> <span class="o">=</span> <span class="n">input_sheets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">input_generator</span><span class="o">.</span><span class="n">frequency_spacing</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">min_frequency</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">max_frequency</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">divisions</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">frequency_spacing</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">min_frequency</span><span class="p">,</span> <span class="n">max_frequency</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">divisions</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Input generator is missing min_frequency, max_frequency, or frequency_spacing - will present linearly from&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_frequency</span><span class="p">),</span> <span class="s">&quot;to&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_frequency</span><span class="p">),</span> <span class="s">&quot;instead.&quot;</span><span class="p">)</span>

        <span class="n">generator</span> <span class="o">=</span> <span class="n">log_frequency_mapper</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">divisions</span><span class="p">,</span> <span class="n">frequency_spacing</span><span class="o">=</span><span class="n">frequency_spacing</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pattern_presenter</span> <span class="o">=</span> <span class="n">PatternPresenter2</span><span class="p">(</span><span class="n">pattern_generator</span><span class="o">=</span><span class="n">generator</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;frequency&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">divisions</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>

</div>
<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Log Frequency Band Preference and Selectivity&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s">&quot;Auditory&quot;</span><span class="p">,</span>
                     <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_log_frequency_preference</span><span class="o">.</span><span class="n">instance</span><span class="p">()],</span> <span class="n">normalize</span><span class="o">=</span><span class="s">&#39;Individually&#39;</span><span class="p">,</span>
                     <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure a best frequency preference and selectivity map for auditory neurons (presents frequencies with logarithmically increasing bandwidth).&#39;</span><span class="p">)</span>

<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;[Log Frequency Band Preference]&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;FrequencyPreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;[Log Frequency Band Selectivity]&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;FrequencySelectivity&#39;</span><span class="p">)])</span>



<div class="viewcode-block" id="latency_mapper"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.latency_mapper">[docs]</a><span class="k">class</span> <span class="nc">latency_mapper</span><span class="p">(</span><span class="n">PatternGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Activates a generator sheet at the specified latency (for all frequencies).</span>
<span class="sd">    It does so by translating from a latency to an x position and presenting a line</span>
<span class="sd">    at that x position (of the specified size).&quot;&quot;&quot;</span>

    <span class="n">__abstract</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">softbounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;Thickness (width) of the latency band for every presentation.&quot;</span><span class="p">)</span>

    <span class="n">min_latency</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Smallest latency on the generator sheet.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">max_latency</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">inclusive_bounds</span><span class="o">=</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span>
        <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;Largest latency on the generator sheet.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">getLatency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">latency_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_latency</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_latency</span>

        <span class="n">sheet_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">lbrt</span><span class="p">()</span>
        <span class="n">x_range</span> <span class="o">=</span> <span class="n">sheet_range</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">sheet_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ratio</span> <span class="o">=</span> <span class="n">latency_range</span> <span class="o">/</span> <span class="n">x_range</span>

        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">sheet_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_latency</span>


    <span class="k">def</span> <span class="nf">setLatency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_latency</span><span class="p">):</span>
        <span class="n">latency_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_latency</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_latency</span>

        <span class="n">sheet_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">lbrt</span><span class="p">()</span>
        <span class="n">x_range</span> <span class="o">=</span> <span class="n">sheet_range</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">sheet_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ratio</span> <span class="o">=</span> <span class="n">latency_range</span> <span class="o">/</span> <span class="n">x_range</span>

        <span class="n">x</span> <span class="o">=</span> <span class="p">((</span><span class="n">new_latency</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">min_latency</span><span class="p">)</span> <span class="o">/</span> <span class="n">ratio</span><span class="p">)</span> <span class="o">+</span> <span class="n">sheet_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>


    <span class="n">latency</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getLatency</span><span class="p">,</span> <span class="n">setLatency</span><span class="p">,</span> <span class="s">&quot;The latency at which to present.&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_x</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="measure_latency_preference"><a class="viewcode-back" href="../../../Reference_Manual/topo.command.analysis-module.html#topo.command.analysis.measure_latency_preference">[docs]</a><span class="k">class</span> <span class="nc">measure_latency_preference</span><span class="p">(</span><span class="n">MeasureResponseCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Measure a best onset latency preference and selectivity map for auditory neurons.&quot;&quot;&quot;</span>

    <span class="n">display</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">static_parameters</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;scale&quot;</span><span class="p">,</span> <span class="s">&quot;offset&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_feature_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="n">input_sheets</span> <span class="o">=</span> <span class="n">topo</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">GeneratorSheet</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

        <span class="c"># BK-NOTE: if anyone wants to generalise this method for heterogeneous sheets, by all means do so,</span>
        <span class="c"># for my personal use the additional code required to generalise was overkill.</span>
        <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_sheets</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">==</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span>
            <span class="k">assert</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="p">]</span><span class="o">.</span><span class="n">xdensity</span> <span class="o">==</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xdensity</span>
            <span class="k">assert</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="p">]</span><span class="o">.</span><span class="n">ydensity</span> <span class="o">==</span> <span class="n">input_sheets</span><span class="p">[</span><span class="n">sheet</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ydensity</span>

        <span class="n">divisions</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">input_sheets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xdensity</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">min_latency</span> <span class="o">=</span> <span class="n">input_sheets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">input_generator</span><span class="o">.</span><span class="n">min_latency</span>
            <span class="n">max_latency</span> <span class="o">=</span> <span class="n">input_sheets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">input_generator</span><span class="o">.</span><span class="n">max_latency</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">min_latency</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">max_latency</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">divisions</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Input generator is missing min_latency or max_latency, setting to&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_latency</span><span class="p">),</span> <span class="s">&quot;&amp;&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_latency</span><span class="p">),</span><span class="s">&quot;respectively.&quot;</span><span class="p">)</span>

        <span class="n">generator</span> <span class="o">=</span> <span class="n">latency_mapper</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">divisions</span><span class="p">,</span> <span class="n">min_latency</span><span class="o">=</span><span class="n">min_latency</span><span class="p">,</span> <span class="n">max_latency</span><span class="o">=</span><span class="n">max_latency</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pattern_presenter</span> <span class="o">=</span> <span class="n">PatternPresenter2</span><span class="p">(</span><span class="n">pattern_generator</span><span class="o">=</span><span class="n">generator</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;latency&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">min_latency</span><span class="p">,</span><span class="n">max_latency</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>

</div>
<span class="n">pg</span><span class="o">=</span> <span class="n">create_plotgroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Latency Preference and Selectivity&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s">&quot;Auditory&quot;</span><span class="p">,</span>
    <span class="n">pre_plot_hooks</span><span class="o">=</span><span class="p">[</span><span class="n">measure_latency_preference</span><span class="o">.</span><span class="n">instance</span><span class="p">()],</span> <span class="n">normalize</span><span class="o">=</span><span class="s">&#39;Individually&#39;</span><span class="p">,</span>
    <span class="n">doc</span><span class="o">=</span><span class="s">&#39;Measure a best onset latency preference and selectivity map for auditory neurons.&#39;</span><span class="p">)</span>

<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;[Latency Preference]&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;LatencyPreference&#39;</span><span class="p">)])</span>
<span class="n">pg</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="s">&#39;[Latency Selectivity]&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;Strength&#39;</span><span class="p">,</span><span class="s">&#39;LatencySelectivity&#39;</span><span class="p">)])</span>



<span class="kn">import</span> <span class="nn">types</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">ParameterizedFunction</span><span class="p">))</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">__name__</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)]))</span>
<span class="n">__all__</span> <span class="o">+=</span> <span class="p">[</span>
    <span class="s">&quot;PatternPresenter2&quot;</span><span class="p">,</span>
    <span class="s">&quot;frequency_mapper&quot;</span><span class="p">,</span>
    <span class="s">&quot;gaussian_corner&quot;</span><span class="p">,</span>
    <span class="s">&quot;latency_mapper&quot;</span><span class="p">,</span>
    <span class="s">&quot;log_frequency_mapper&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/topo-banner7.png" alt="Logo"/>
            </a></p>
<ul class="global-toc">
<li><a href="../../../index.html">Home</a></li>
<li><a href="../../../News/index.html">News</a></li>
<li><a href="../../../Downloads/index.html">Downloads</a></li>
<li><a href="../../../Tutorials/index.html">Tutorials</a></li>
<li><a href="../../../User_Manual/index.html">User Manual</a></li>
<li><a href="../../../Reference_Manual/index.html">Reference Manual</a></li>
<li><a href="../../../Developer_Manual/index.html">Developer Manual</a></li>
<li><a href="../../../Forums/index.html">Forums</a></li>
<li><a href="../../../Team_Members/index.html">Team Members</a></li>
<li><a href="../../../Future_Work/index.html">Future Work</a></li>
<li><a href="../../../FAQ/index.html">FAQ</a></li>
<li><a href="../../../Links/index.html">Links</a></li>
<li><a href="../../../Home/pubs.html">Publications</a></li>
</ul>
<h3><a href="../../../index.html">Table Of Contents</a></h3>


<h3>This Page</h3>
<ul class="this-page-menu">
	<li><a	href="https://github.com/wiktr/topographica/edit/doc/doc/_modules/topo/command/analysis.rst" rel="nofollow">Edit on GitHub</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
<li><a href="../../../index.html">Home</a></li>
<li><a href="../../../Downloads/index.html">Downloads</a></li>
<li><a href="../../../Tutorials/index.html">Tutorials</a></li>
<li><a href="../../../User_Manual/index.html">User Manual</a></li>


<li><ul class="parents">



          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../command.html" >topo.command</a> &raquo;</li>

</ul></li>


      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, IOAM.
      Last updated on May 09, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>